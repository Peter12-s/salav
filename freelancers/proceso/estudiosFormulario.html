<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SALAV</title>
  <link rel="stylesheet" href="../../plantilla.css">
  <link rel="stylesheet" href="../../freelancers/proceso/estudiosFormulario.css">
  <link rel="stylesheet" href="estudiosPendientes.css">
  <link rel="icon" type="image/x-icon" href="../../img/favicon.ico">

</head>

<body>
 <div id="preloader">
        <img width="150px" src="../../img/Logo.png" alt="Cargando..." />
    </div>
  <plantilla-salav>
    <div class="slot-header" slot="header">
      <img style="width: 150px;" src="../../img/Silueta Clara.png" alt="">
      <nav id="menu">
        <a href="../pendientes/estudiosPendientes.html">Estudios pendientes</a>
        <a href="estudiosProceso.html">Estudios en proceso</a>
        <!-- Botón Logout con SVG -->
        <button class="logout-btn" id="btnLogout" aria-label="Cerrar sesión" title="Cerrar sesión">
          <!-- SVG de logout (salir) -->
          <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
            <!-- Flecha de salida -->
            <path d="M16 17l5-5-5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
            <path d="M21 12H9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" />
            <!-- Marco/puerta -->
            <path d="M13 21H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" />
          </svg>
        </button>
      </nav>
      <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    <div slot="main">
      <section class="salav-carousel" aria-label="Formulario Estudio Socioeconómico SALAV - versión extendida">
  <div class="salav-header">
    <div class="salav-logo">SALAV</div>
    <div class="salav-title-area">
      <h1 class="salav-title">Estudio Socioeconómico SALAV</h1>
      <p class="salav-sub">Un estudio socioeconómico tiene como objetivo conocer la situación económica y social de una persona o familia.</p>
    </div>
  </div>

  <!-- Progress + dots: insertar justo después de .salav-header, antes del form -->
    <div class="progress-container">
    <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
    <div class="progress-text">
        <div id="progressLabel">Sección 1 / N</div>
        <div id="progressPercent">0%</div>
    </div>
    <div class="section-indicator" id="sectionDots" aria-hidden="false" style="margin-top:8px"></div>
    </div>


  <form id="salav-form" class="salav-slider" autocomplete="off" enctype="multipart/form-data">
    <!-- DATOS GENERALES -->
    <div class="salav-card">
      <h2 class="section-title">Datos generales</h2>
      <div class="salav-grid">
        
        <div class="salav-field">
          <label for="folio" class="required">Folio</label>
          <input id="folio" name="folio" type="text" required />
        </div>
        <div class="salav-field">
          <label for="fecha_solicitud">Fecha de solicitud</label>
          <input id="fecha_solicitud" name="fecha_solicitud" type="date" required />
        </div>
        <div class="salav-field">
          <label for="fecha_visita">Fecha de visita</label>
          <input id="fecha_visita" name="fecha_visita" type="date" />
        </div>
        <div class="salav-field">
          <label for="puesto">Puesto para el que postula</label>
          <input id="puesto" name="puesto" type="text" />
        </div>
        <div class="salav-field">
            <label for="fotografia">Fotografía (archivo)</label>
            <div class="file-upload" id="fotografia-upload">
                <span>Haga clic para subir una fotografía</span>
                <input id="fotografia" name="fotografia" type="file" accept="image/*" />
            </div>
            <div class="file-name" id="fotografia-name"></div>
        </div>

       
      </div>
    </div>

    <!-- DATOS DE LA EMPRESA VALUADORA -->
    <div class="salav-card">
      <h2 class="section-title">Datos de la empresa valuadora</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="valuador_nombre">Nombre del evaluador</label>
          <input id="valuador_nombre" name="valuador_nombre" type="text" />
        </div>
      </div>
    </div>

    <!-- DATOS DE LA EMPRESA SOLICITANTE -->
    <div class="salav-card">
      <h2 class="section-title">Datos de la empresa solicitante</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="solicitante_razon2">Razón social (empresa solicitante)</label>
          <input id="solicitante_razon2" name="solicitante_razon2" type="text" />
        </div>
        <div class="salav-field">
          <label for="solicitante_contacto">Contacto</label>
          <input id="solicitante_contacto" name="solicitante_contacto" type="text" />
        </div>
        <div class="salav-field">
          <label for="solicitante_email">E-Mail</label>
          <input id="solicitante_email" name="solicitante_email" type="email" />
        </div>
      </div>
    </div>

    <!-- DATOS DEL CANDIDATO -->
    <div class="salav-card">
      <h2 class="section-title">Datos del candidato</h2>
      <div class="salav-grid">
        <div class="salav-field salav-full">
          <label for="candidato_nombre">Nombre completo del candidato</label>
          <input id="candidato_nombre" name="candidato_nombre" type="text" />
        </div>
        <div class="salav-field">
          <label for="fecha_nacimiento">Fecha de nacimiento</label>
          <input id="fecha_nacimiento" name="fecha_nacimiento" type="date" />
        </div>

        <div class="salav-field">
          <label for="lugar_nacimiento">Lugar de nacimiento</label>
          <input id="lugar_nacimiento" name="lugar_nacimiento" type="text" />
        </div>

        <div class="salav-field">
          <label for="edad">Edad</label>
          <input id="edad" name="edad" type="number" min="0" />
        </div>

        

        <div class="salav-field">
          <label for="rfc">RFC</label>
          <input id="rfc" name="rfc" type="text" />
        </div>
        
        <div class="salav-field">
          <label for="estado_civil">Estado civil</label>
          <select id="estado_civil" name="estado_civil">
            <option value="">-- selecciona --</option>
            <option>Soltero</option>
            <option>Casado</option>
            <option>Viudo</option>
            <option>Divorciado</option>
            <option>Unión libre</option>
          </select>
        </div>

        <div class="salav-field">
          <label for="num_hijos">Número de hijos</label>
          <input id="num_hijos" name="num_hijos" type="number" min="0" />
        </div>


        <div class="salav-field">
          <label for="telefono">Celular</label>
          <input id="telefono" name="telefono" type="text" />
        </div>

        <div class="salav-field salav-full">
          <label for="correo">Correo</label>
          <input id="correo" name="correo" type="email" required />
        </div>

        <div class="salav-field">
          <label for="telefono_recados">Teléfono de recados</label>
          <input id="telefono_recados" name="telefono_recados" type="text" />
        </div>

        
        <div class="salav-field salav-full">
          <label for="direccion">Dirección completa</label>
          <input id="direccion" name="direccion" type="text" />
        </div>

        <div class="salav-field">
          <label for="colonia">Colonia</label>
          <input id="colonia" name="colonia" type="text" />
        </div>

        <div class="salav-field">
          <label for="ciudad">Delegación / Ciudad / Municipio</label>
          <input id="ciudad" name="ciudad" type="text" />
        </div>

        <div class="salav-field">
          <label for="estado">Estado</label>
          <input id="estado" name="estado" type="text" />
        </div>

        <div class="salav-field">
          <label for="pais">País</label>
          <input id="pais" name="pais" type="text" />
        </div>

        <div class="salav-field">
          <label for="codigo_postal">Código postal</label>
          <input id="codigo_postal" name="codigo_postal" type="text" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Tiene familiares o conocidos trabajando en esta empresa?</label>
          <div>
            <label><input type="radio" name="familia_empresa" value="Sí"> Sí</label>
            <label style="margin-left:8px;"><input type="radio" name="familia_empresa" value="No" checked> No</label>
          </div>
        </div>

        <div class="salav-field">
          <label for="nombre_familiar">Nombre del familiar o conocido</label>
          <input id="nombre_familiar" name="nombre_familiar" type="text" />
        </div>
      </div>
    </div>

    <!-- CROQUIS DE UBICACIÓN -->
    <div class="salav-card">
      <h2 class="section-title">Croquis de ubicación</h2>
      <div class="salav-grid">
        <div class="salav-field salav-full">
          <label for="croquis">Carga el croquis o mapa; para este punto puedes realizar un screenshot de google maps</label>
           <div class="file-upload" id="croquis-upload">
                <span>Haga clic para subir</span>
                <input id="croquis" name="croquis" type="file" accept="image/*,application/pdf" />
            </div>
            <div class="file-name" id="croquis-name"></div>
        </div>
      </div>
    </div>

    <!-- FOTOGRAFÍAS DEL DOMICILIO -->
    <div class="salav-card">
      <h2 class="section-title">Fotografías del domicilio</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="foto_fachada_exterior">Fotografía del candidato con la fachada exterior a su domicilio desde la calle</label>
          <div class="file-upload" id="ext-upload">
                <span>Haga clic para subir</span>
                <input id="foto_fachada_exterior" name="foto_fachada_exterior" type="file" accept="image/*" />
          </div>
            <div class="file-name" id="ext-name"></div>
        </div>
        <div class="salav-field">
          <label for="foto_fachada_interior">Fotografía del candidato con la fachada Interior de su domicilio</label>
          <div class="file-upload" id="int-upload">
                <span>Haga clic para subir</span>
                <input id="foto_fachada_interior" name="foto_fachada_interior" type="file" accept="image/*" />
          </div>
            <div class="file-name" id="int-name"></div>
        </div>
        <div class="salav-field">
          <label for="foto_sala">Fotografía del candidato en sala / comedor </label>
          <div class="file-upload" id="sala-upload">
                <span>Haga clic para subir</span>
                <input id="foto_sala" name="foto_sala" type="file" accept="image/*" />
          </div>
            <div class="file-name" id="sala-name"></div>
        </div>
        <div class="salav-field">
          <label for="foto_entregando_documentos">Fotografía del candidato entregando documentos </label>
          <div class="file-upload" id="docs-upload">
                <span>Haga clic para subir</span>
                <input id="foto_entregando_documentos" name="foto_entregando_documentos" type="file" accept="image/*" />
          </div>
            <div class="file-name" id="docs-name"></div>
        </div>
      </div>
    </div>

    <!-- NÚCLEO FAMILIAR (dinámico e ilimitado) -->
    <div class="salav-card">
      <h2 class="section-title">Núcleo familiar</h2>
      <p class="salav-meta">Rellena los datos de cada familiar. Si no aplica, deja vacío. Puedes agregar cuántos familiares necesites.</p>

      <div id="familiares-wrap" class="salav-grid">
        <!-- plantilla inicial vacía; se usarán entradas dinámicas -->
      </div>

      <div style="margin-top:10px">
        <button type="button" id="add-familiar-btn" class="btn salav-small-btn">+ Agregar familiar</button>
      </div>
    </div>

    <!-- SITUACIÓN ECONÓMICA — ESTILO DE VIDA (termina en 'otros ingresos') -->
    <div class="salav-card">
      <h2 class="section-title">Situación económica - Estilo de vida/h2>
      <div class="salav-grid">
        <div class="salav-field salav-full">
          <label for="sueldo_actual">Sueldo actual del candidato</label>
          <input id="sueldo_actual" name="sueldo_actual" type="text" />
        </div>

        <div class="salav-field">
          <label for="ingresos_negocio">Ingresos por negocio</label>
          <input id="ingresos_negocio" name="ingresos_negocio" type="text" />
        </div>

        <div class="salav-field">
          <label for="ingresos_oficio">Ingresos por oficio</label>
          <input id="ingresos_oficio" name="ingresos_oficio" type="text" />
        </div>

        <div class="salav-field salav-full">
          <label for="otros_ingresos">Otros ingresos (especificar)</label>
          <input id="otros_ingresos" name="otros_ingresos" type="text" placeholder="Especifique de dónde provienen sus otros ingresos" />
        </div>
      </div>
    </div>

    <!-- SITUACIÓN ECONÓMICA — INGRESOS FAMILIARES -->
    <div class="salav-card">
      <h2 class="section-title">Situación económica - Ingresos familiares</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="ingresos_conyuge">Ingresos del cónyuge</label>
          <input id="ingresos_conyuge" name="ingresos_conyuge" type="text" />
        </div>
        <div class="salav-field">
          <label for="ingresos_padres">Ingresos de los padres</label>
          <input id="ingresos_padres" name="ingresos_padres" type="text" />
        </div>
        <div class="salav-field">
          <label for="ingresos_hijos">Ingresos de los hijos</label>
          <input id="ingresos_hijos" name="ingresos_hijos" type="text" />
        </div>
        <div class="salav-field">
          <label for="ingresos_hermanos">Ingresos de los hermanos</label>
          <input id="ingresos_hermanos" name="ingresos_hermanos" type="text" />
        </div>
        <div class="salav-field salav-full">
          <label for="otros_ingresos_familiares">Otros ingresos familiares (especificar)</label>
          <input id="otros_ingresos_familiares" name="otros_ingresos_familiares" type="text" />
        </div>
      </div>
    </div>

    <!-- SITUACIÓN ECONÓMICA — GASTOS DE TRASLADO -->
    <div class="salav-card">
      <h2 class="section-title">Situación económica - Gastos de traslado</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="gasto_pasajes">Pasajes</label>
          <input id="gasto_pasajes" name="gasto_pasajes" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_taxi">Taxi / Uber</label>
          <input id="gasto_taxi" name="gasto_taxi" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_gasolina">Gasolina</label>
          <input id="gasto_gasolina" name="gasto_gasolina" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_casetas">Casetas</label>
          <input id="gasto_casetas" name="gasto_casetas" type="text" />
        </div>
      </div>
    </div>

    <!-- SITUACIÓN ECONÓMICA — EGRESOS MENSUALES DEL CANDIDATO -->
    <div class="salav-card">
      <h2 class="section-title">Situación económica - Egresos mensuales del candidato</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="gasto_alimentacion">¿Cuánto gasta en alimentación?</label>
          <input id="gasto_alimentacion" name="gasto_alimentacion" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_agua_potable">¿Cuanto gasta en Servicio de agua potable?</label>
          <input id="gasto_agua_potable" name="gasto_agua_potable" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_luz">¿Cuanto gasta en servicio de luz?</label>
          <input id="gasto_luz" name="gasto_luz" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_internet">¿Cuanto gasta en servicio de internet?</label>
          <input id="gasto_internet" name="gasto_internet" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_telefonia">¿Cuánto gasta en telefonía?</label>
          <input id="gasto_telefonia" name="gasto_telefonia" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_streaming">¿Cuánto gasta en servicios de streaming?</label>
          <input id="gasto_streaming" name="gasto_streaming" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_mantenimiento_hogar">¿Cuánto gasta en mantenimiento del hogar?</label>
          <input id="gasto_mantenimiento_hogar" name="gasto_mantenimiento_hogar" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_mantenimiento_vehicular">¿Cuánto gasta en mantenimiento vehicular?</label>
          <input id="gasto_mantenimiento_vehicular" name="gasto_mantenimiento_vehicular" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_pension_alimenticia">¿Cuánto gasta en pensión alimenticia?</label>
          <input id="gasto_pension_alimenticia" name="gasto_pension_alimenticia" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_salidas_recreativas">¿Cuánto gasta en salidas recreativas?</label>
          <input id="gasto_salidas_recreativas" name="gasto_salidas_recreativas" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_membresias">¿Cuánto gasta en membresías y club social?</label>
          <input id="gasto_membresias" name="gasto_membresias" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_seguros_vida">¿Cuánto gasta en seguros de vida?</label>
          <input id="gasto_seguros_vida" name="gasto_seguros_vida" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_seguro_vehiculo">¿Cuánto gasta en seguro de vehículo?</label>
          <input id="gasto_seguro_vehiculo" name="gasto_seguro_vehiculo" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_credito_vivienda">¿Cuánto gasta en crédito de vivienda?</label>
          <input id="gasto_credito_vivienda" name="gasto_credito_vivienda" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_credito_vehicular">¿Cuánto gasta en crédito vehicular?</label>
          <input id="gasto_credito_vehicular" name="gasto_credito_vehicular" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_hipoteca">¿Cuánto gasta en hipoteca?</label>
          <input id="gasto_hipoteca" name="gasto_hipoteca" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_mascotas">¿Cuánto gasta en mascotas?</label>
          <input id="gasto_mascotas" name="gasto_mascotas" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_consultas_medicas">¿Cuánto gasta en consultas médicas?</label>
          <input id="gasto_consultas_medicas" name="gasto_consultas_medicas" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_educacion">¿Cuánto gasta en educación?</label>
          <input id="gasto_educacion" name="gasto_educacion" type="text" />
        </div>
        <div class="salav-field">
          <label for="gasto_ropa_calzado">¿Cuánto gasta en ropa y calzado?</label>
          <input id="gasto_ropa_calzado" name="gasto_ropa_calzado" type="text" />
        </div>
      </div>
    </div>

    <!-- ESTILO DE VIDA - VEHÍCULO -->
    <div class="salav-card">
      <h2 class="section-title">Estilo de vida — Comodidades (vehículo)</h2>
      <div class="salav-grid">
        <div class="salav-field salav-full">
          <label>¿Cuenta con vehículo?</label>
          <div>
            <label><input type="radio" name="tiene_vehiculo" value="Sí" id="tiene_vehiculo_si"> Sí</label>
            <label style="margin-left:8px;"><input type="radio" name="tiene_vehiculo" value="No" id="tiene_vehiculo_no" checked> No</label>
          </div>
        </div>

        <div id="vehiculo-block" class="salav-field salav-full" style="display:none">
          <label for="veh_marca">Marca</label>
          <input id="veh_marca" name="veh_marca" type="text" />
          <label for="veh_modelo" style="margin-top:8px">Modelo</label>
          <input id="veh_modelo" name="veh_modelo" type="text" />
          <label for="veh_ano" style="margin-top:8px">Año</label>
          <input id="veh_ano" name="veh_ano" type="text" />
           <label for="veh_color" style="margin-top:8px">Color</label>
          <input id="veh_color" name="veh_color" type="text" />
        </div>
      </div>
    </div>

    <!-- ESTILO DE VIDA COMODIDADES 2 -->
    <div class="salav-card">
      <h2 class="section-title">Estilo de vida - Comodidades 2</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="cuenta_computadora">¿Cuenta con computadora?</label>
          <select id="cuenta_computadora" name="cuenta_computadora"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_bicicleta">¿Cuenta con bicicleta?</label>
          <select id="cuenta_bicicleta" name="cuenta_bicicleta"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_tablet">¿Cuenta con tablet?</label>
          <select id="cuenta_tablet" name="cuenta_tablet"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_refri">¿Cuenta con refigerador?</label>
          <select id="cuenta_refri" name="cuenta_refri"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_tv">¿Cuenta con televisión / pantalla?</label>
          <select id="cuenta_tv" name="cuenta_tv"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_microondas">¿Cuenta con microondas?</label>
          <select id="cuenta_microondas" name="cuenta_microondas"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_estufa">¿Cuenta con estufa?</label>
          <select id="cuenta_estufa" name="cuenta_estufa"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_lavadora">¿Cuenta con lavadora?</label>
          <select id="cuenta_lavadora" name="cuenta_lavadora"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_motocicleta">¿Cuenta con motocicleta?</label>
          <select id="cuenta_motocicleta" name="cuenta_motocicleta"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
      </div>
    </div>

    <!-- MOTOCICLETA (condicional) -->
    <div id="motocicleta-block" class="salav-card" style="display:none">
      <h2 class="section-title">Estilo de vida — Comodidades (motocicleta)</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="moto_marca">Marca</label>
          <input id="moto_marca" name="moto_marca" type="text" />
        </div>
        <div class="salav-field">
          <label for="moto_modelo">Modelo</label>
          <input id="moto_modelo" name="moto_modelo" type="text" />
        </div>
        <div class="salav-field">
          <label for="moto_ano">Año</label>
          <input id="moto_ano" name="moto_ano" type="text" />
        </div>
        <div class="salav-field">
          <label for="moto_color">Color</label>
          <input id="moto_color" name="moto_color" type="text" />
        </div>
      </div>
    </div>

    <!-- ESTILO DE VIDA COMODIDADES 3 -->
    <div class="salav-card">
      <h2 class="section-title">Estilo de vida - Comodidades - 3</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="cuenta_camara">¿Cuenta con cámara fotográfica?</label>
          <select id="cuenta_camara" name="cuenta_camara"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_freidora">¿Cuenta con freidora de aire?</label>
          <select id="cuenta_freidora" name="cuenta_freidora"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_horno_electrico">¿Cuenta con horno eléctrico?</label>
          <select id="cuenta_horno_electrico" name="cuenta_horno_electrico"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_batidora">¿Cuenta con batidora?</label>
          <select id="cuenta_batidora" name="cuenta_batidora"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_tostador">¿Cuenta con tostador?</label>
          <select id="cuenta_tostador" name="cuenta_tostador"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_dispensador">¿Cuenta con dispensador de agua?</label>
          <select id="cuenta_dispensador" name="cuenta_dispensador"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_licuadora">¿Cuenta con licuadora?</label>
          <select id="cuenta_licuadora" name="cuenta_licuadora"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_tanque_gas">¿Cuenta con tanque de gas?</label>
          <select id="cuenta_tanque_gas" name="cuenta_tanque_gas"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_celular">¿Cuenta con celular?</label>
          <select id="cuenta_celular" name="cuenta_celular"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
      </div>
    </div>

    <!-- COMODIDADES - CELULAR (condicional) -->
    <div id="celular-block" class="salav-card" style="display:none">
      <h2 class="section-title">Comodidades — Celular</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="cel_marca">Marca</label>
          <input id="cel_marca" name="cel_marca" type="text" />
        </div>
        <div class="salav-field">
          <label for="cel_modelo">Modelo</label>
          <input id="cel_modelo" name="cel_modelo" type="text" />
        </div>
      </div>
    </div>

    <!-- ESTILO DE VIDA COMODIDADES 4 -->
    <div class="salav-card">
      <h2 class="section-title">Estilo de vida — Comodidades 4</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="cuenta_cama">¿Cuenta con cama?</label>
          <select id="cuenta_cama" name="cuenta_cama"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_sala">¿Cuenta con sala?</label>
          <select id="cuenta_sala" name="cuenta_sala"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_cocina_integral">¿Cuenta con cocina integral?</label>
          <select id="cuenta_cocina_integral" name="cuenta_cocina_integral"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_closet">¿Cuenta con closet?</label>
          <select id="cuenta_closet" name="cuenta_closet"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_banio">¿Cuenta con baño?</label>
          <select id="cuenta_banio" name="cuenta_banio"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_calentador_solar">¿Cuenta con calentador solar?</label>
          <select id="cuenta_calentador_solar" name="cuenta_calentador_solar"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_calentador_boiler">¿Cuenta con calentador de paso o boiler?</label>
          <select id="cuenta_calentador_boiler" name="cuenta_calentador_boiler"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
        <div class="salav-field">
          <label for="cuenta_panel_solar">¿Cuenta con panel solar?</label>
          <select id="cuenta_panel_solar" name="cuenta_panel_solar"><option value="No">No</option><option value="Sí">Sí</option></select>
        </div>
      </div>
    </div>

    <!-- SERVICIOS DE LA ZONA DOMICILIARIA -->
    <div class="salav-card">
      <h2 class="section-title">Servicios de la zona domiciliaria</h2>
      <div class="salav-grid">
        <div class="salav-field"><label for="agua_potable">¿Cuentan con agua potable?</label><select id="agua_potable" name="agua_potable"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="energia_electrica">¿Cuentan con energía eléctrica?</label><select id="energia_electrica" name="energia_electrica"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="drenaje">¿Cuentan con drenaje?</label><select id="drenaje" name="drenaje"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="pavimentacion">¿Cuentan con pavimentación?</label><select id="pavimentacion" name="pavimentacion"><option>Sí</option><option>No</option></select></div>

        <div class="salav-field"><label for="alumbrado_publico">¿Cuentan con alumbrado público?</label><select id="alumbrado_publico" name="alumbrado_publico"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="lineas_telefonicas">¿Cuentan con líneas telefónicas?</label><select id="lineas_telefonicas" name="lineas_telefonicas"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="lineas_internet">¿Cuentan con líneas de internet?</label><select id="lineas_internet" name="lineas_internet"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="lineas_gas">¿Cuentan con líneas de gas natural?</label><select id="lineas_gas" name="lineas_gas"><option>Sí</option><option>No</option></select></div>

        <div class="salav-field"><label for="lineas_cable">¿Cuentan con líneas de cable?</label><select id="lineas_cable" name="lineas_cable"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="escuelas">¿Cuentan con escuelas en la colonia?</label><select id="escuelas" name="escuelas"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="hospitales">¿Cuentan con hospitales en la colonia?</label><select id="hospitales" name="hospitales"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="centros_comerciales">¿Cuentan con centros comerciales en la colonia?</label><select id="centros_comerciales" name="centros_comerciales"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="club_social_colonia">¿Cuentan con club social o deportivo en la colonia?</label><select id="club_social_colonia" name="club_social_colonia"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="parques_recreativos">¿Cuentan con parques recreativos en la colonia?</label><select id="parques_recreativos" name="parques_recreativos"><option>Sí</option><option>No</option></select></div>

        <div class="salav-field"><label for="recoleccion_residuos">¿Cuentan con recolección de residuos?</label><select id="recoleccion_residuos" name="recoleccion_residuos"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="transporte_publico">¿Cuentan con transporte público?</label><select id="transporte_publico" name="transporte_publico"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="cuenta_metro">¿Cuentan con metro?</label><select id="cuenta_metro" name="cuenta_metro"><option>Sí</option><option>No</option></select></div>
        <div class="salav-field"><label for="cuenta_teleferico">¿Cuentan con teleférico / maxicable?</label><select id="cuenta_teleferico" name="cuenta_teleferico"><option>Sí</option><option>No</option></select></div>
      </div>
    </div>

    <!-- DATOS ACADÉMICOS: BASE Y agregado dinamico -->
    <div class="salav-card">
      <h2 class="section-title">Datos académicos</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="ultimo_nivel">Último nivel académico</label>
          <select id="ultimo_nivel" name="ultimo_nivel">
            <option value="">--</option>
            <option>Primaria</option><option>Secundaria</option><option>Preparatoria</option>
            <option>Carrera técnica</option><option>Licenciatura</option><option>Maestría</option><option>Doctorado</option>
          </select>
        </div>

        <div class="salav-field">
          <label for="institucion">Institución</label>
          <input id="institucion" name="institucion" type="text" />
        </div>

        <div class="salav-field">
          <label for="entidad_federativa">Entidad federativa</label>
          <input id="entidad_federativa" name="entidad_federativa" type="text" />
        </div>

        <div class="salav-field salav-full">
          <label for="documento_recibido">Documento recibido</label>
          <input id="documento_recibido" name="documento_recibido" type="text" placeholder="Ej: certificado, constancia, etc." />
        </div>
      </div>

      <div id="niveles-wrap" class="salav-grid" style="gap:8px;margin-top:8px"></div>

        <div style="margin-top:10px">
        <button type="button" id="add-nivel-btn" class="btn salav-small-btn">+ Agregar otro nivel académico</button>
        </div>
    </div>

    <!-- DATOS ACADEMICOS ACTUALES -->
    <div class="salav-card">
      <h2 class="section-title">Datos academicos — Actuales</h2>
      <div class="salav-grid">
        <div class="salav-field salav-full">
          <label>¿Estudia actualmente?</label>
          <div>
            <label><input type="radio" name="estudia_actualmente" value="Sí"> Sí</label>
            <label style="margin-left:8px"><input type="radio" name="estudia_actualmente" value="No" checked> No</label>
          </div>
        </div>
        <div class="salav-field" id="que_estudia_field" style="display:none">
          <label for="que_estudia">¿Qué estudia?</label>
          <input id="que_estudia" name="que_estudia" type="text" />
        </div>
      </div>
    </div>

    <!-- CURSOS Y CERTIFICADOS -->
    <div class="salav-card">
      <h2 class="section-title">Datos academicos  — Cursos y certificados</h2>
      <div id="cursos-wrap" class="salav-grid"></div>
      <div style="margin-top:10px">
        <button type="button" id="add-curso-btn" class="btn salav-small-btn">+ Agregar curso o certificación</button>
      </div>
    </div>

    <!-- INVESTIGACIÓN LABORAL (dinámica) -->
    <div class="salav-card">
      <h2 class="section-title">Investigación laboral (últimas empresas)</h2>
      <div id="empresas-wrap" class="salav-grid"></div>
      <div style="margin-top:10px">
        <button type="button" id="add-empresa-btn" class="btn salav-small-btn">+ Agregar empresa</button>
      </div>
    </div>

    <!-- REFERENCIAS (4 tipos) -->
    <div class="salav-card">
      <h2 class="section-title">Referencias</h2>
      <p class="salav-meta">Agrega referencias personales, laborales, vecinales y familiares. Cada referencia incluye pregunta "Tiempo de conocerse".</p>

      <h3 style="margin-top:12px">Personales</h3>
      <div id="refs-personales-wrap" class="salav-grid"></div>
      <button type="button" id="add-ref-personal" class="btn salav-small-btn" style="margin-top:8px">+ Agregar referencia personal</button>

      <h3 style="margin-top:12px">Laborales</h3>
      <div id="refs-laborales-wrap" class="salav-grid"></div>
      <button type="button" id="add-ref-laboral" class="btn salav-small-btn" style="margin-top:8px">+ Agregar referencia laboral</button>

      <h3 style="margin-top:12px">Vecinal</h3>
      <div id="refs-vecinal-wrap" class="salav-grid"></div>
      <button type="button" id="add-ref-vecinal" class="btn salav-small-btn" style="margin-top:8px">+ Agregar referencia vecinal</button>

      <h3 style="margin-top:12px">Familiar</h3>
      <div id="refs-familiar-wrap" class="salav-grid"></div>
      <button type="button" id="add-ref-familiar" class="btn salav-small-btn" style="margin-top:8px">+ Agregar referencia familiar</button>
    </div>

    <!-- CUESTIONARIO - ESTADO DE SALUD (extenso con condicionales) -->
    <div class="salav-card">
      <h2 class="section-title">Cuestionario — Estado de salud</h2>
      <div class="salav-grid">
        <div class="salav-field"><label for="nss">Número de Seguridad Social (NSS)</label><input id="nss" name="nss" type="text" /></div>
        <div class="salav-field"><label for="tipo_sangre">Tipo de sangre y RH</label><input id="tipo_sangre" name="tipo_sangre" type="text" /></div>
        <div class="salav-field"><label for="estatura">Estatura</label><input id="estatura" name="estatura" type="text" /></div>
        <div class="salav-field"><label for="peso">Peso</label><input id="peso" name="peso" type="text" /></div>

        <div class="salav-field salav-full">
          <label>¿Utiliza lentes actualmente?</label>
          <div><label><input type="radio" name="utiliza_lentes" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="utiliza_lentes" value="No" checked> No</label></div>
        </div>
        <div class="salav-field salav-full"><label for="justificacion_lentes">Justificación (si aplica)</label><input id="justificacion_lentes" name="justificacion_lentes" type="text" /></div>

        <!-- a partir de aquí varias preguntas con condicionales: si "Sí" → aparece campo detalle/justificación -->
        <div class="salav-field salav-full">
          <label>¿Ha consultado algún médico últimamente?</label>
          <div><label><input type="radio" name="ha_consultado_medico" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="ha_consultado_medico" value="No" checked> No</label></div>
          <input id="ha_consultado_medico_just" name="ha_consultado_medico_just" type="text" placeholder="¿Por qué razón? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Ha sufrido alguna intervención quirúrgica (operación)?</label>
          <div><label><input type="radio" name="ha_sufrido_cirugia" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="ha_sufrido_cirugia" value="No" checked> No</label></div>
          <input id="ha_sufrido_cirugia_just" name="ha_sufrido_cirugia_just" type="text" placeholder="¿Por qué razón? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Tiene alguna discapacidad?</label>
          <div><label><input type="radio" name="tiene_discapacidad" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="tiene_discapacidad" value="No" checked> No</label></div>
          <input id="tiene_discapacidad_just" name="tiene_discapacidad_just" type="text" placeholder="¿Cuál? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Le han practicado estudios especiales para diagnosticar alguna enfermedad?</label>
          <div><label><input type="radio" name="practicado_estudios" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="practicado_estudios" value="No" checked> No</label></div>
          <input id="practicado_estudios_just" name="practicado_estudios_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Actualmente está bajo algún tratamiento (toma algún medicamento)?</label>
          <div><label><input type="radio" name="bajo_tratamiento" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="bajo_tratamiento" value="No" checked> No</label></div>
          <input id="bajo_tratamiento_just" name="bajo_tratamiento_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Ha tenido transfusiones sanguíneas en los últimos 2 años?</label>
          <div><label><input type="radio" name="transfusiones" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="transfusiones" value="No" checked> No</label></div>
          <input id="transfusiones_just" name="transfusiones_just" type="text" placeholder="¿Por qué razón? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Utiliza drogas (medicamentos) por prescripción médica?</label>
          <div><label><input type="radio" name="usa_drogas_prescripcion" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="usa_drogas_prescripcion" value="No" checked> No</label></div>
          <input id="usa_drogas_prescripcion_just" name="usa_drogas_prescripcion_just" type="text" placeholder="¿Cuál y por qué razón? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Enfermedades: piel/sangre -->
        <div class="salav-field salav-full">
          <label>¿Padece/ha padecido enfermedades de la piel o de la sangre (ej.: leucemia, lupus, cáncer de piel, alergia)?</label>
          <div><label><input type="radio" name="enf_piel_sangre" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_piel_sangre" value="No" checked> No</label></div>
          <input id="enf_piel_sangre_just" name="enf_piel_sangre_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Ojos / oídos -->
        <div class="salav-field salav-full">
          <label>¿Padece/ha padecido enfermedades de los ojos u oídos (ej.: conjuntivitis, infecciones, etc.)?</label>
          <div><label><input type="radio" name="enf_ojo_oido" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_ojo_oido" value="No" checked> No</label></div>
          <input id="enf_ojo_oido_just" name="enf_ojo_oido_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Corazón -->
        <div class="salav-field salav-full">
          <label>¿Padece/ha padecido infarto al miocardio, insuficiencia cardiaca u otro padecimiento del corazón?</label>
          <div><label><input type="radio" name="enf_corazon" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_corazon" value="No" checked> No</label></div>
          <input id="enf_corazon_just" name="enf_corazon_just" type="text" placeholder="Justificación" style="margin-top:6px;display:none" />
        </div>

        <!-- Pulmones -->
        <div class="salav-field salav-full">
          <label>¿Padece asma, tuberculosis o cualquier otra enfermedad de bronquios o pulmones?</label>
          <div><label><input type="radio" name="enf_pulmones" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_pulmones" value="No" checked> No</label></div>
          <input id="enf_pulmones_just" name="enf_pulmones_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Sistema nervioso -->
        <div class="salav-field salav-full">
          <label>¿Padece epilepsia o cualquier otro padecimiento del sistema nervioso?</label>
          <div><label><input type="radio" name="enf_sistema_nervioso" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_sistema_nervioso" value="No" checked> No</label></div>
          <input id="enf_sistema_nervioso_just" name="enf_sistema_nervioso_just" type="text" placeholder="¿Cuál? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Diabetes / glandular -->
        <div class="salav-field salav-full">
          <label>¿Padece diabetes o cualquier otro padecimiento del sistema glandular?</label>
          <div><label><input type="radio" name="enf_glandular" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_glandular" value="No" checked> No</label></div>
          <input id="enf_glandular_just" name="enf_glandular_just" type="text" placeholder="¿Cuál? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Digestivo -->
        <div class="salav-field salav-full">
          <label>¿Padece úlcera del estómago, intestinos u otro padecimiento del aparato digestivo?</label>
          <div><label><input type="radio" name="enf_digestivo" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_digestivo" value="No" checked> No</label></div>
          <input id="enf_digestivo_just" name="enf_digestivo_just" type="text" placeholder="¿Cuál? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Músculo-esquelético -->
        <div class="salav-field salav-full">
          <label>¿Padece artritis, trastornos de la columna u otro padecimiento del sistema músculo-esquelético?</label>
          <div><label><input type="radio" name="enf_musculo_esqueletico" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_musculo_esqueletico" value="No" checked> No</label></div>
          <input id="enf_musculo_esqueletico_just" name="enf_musculo_esqueletico_just" type="text" placeholder="¿Cuál? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Hernias -->
        <div class="salav-field salav-full">
          <label>¿Padece hernias?</label>
          <div><label><input type="radio" name="enf_hernias" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="enf_hernias" value="No" checked> No</label></div>
          <input id="enf_hernias_just" name="enf_hernias_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <!-- Alergias medicamentos -->
        <div class="salav-field salav-full">
          <label>¿Es alérgico a algún medicamento (ej.: penicilina…)?</label>
          <div><label><input type="radio" name="alergico_medicamento" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="alergico_medicamento" value="No" checked> No</label></div>
          <input id="alergico_medicamento_just" name="alergico_medicamento_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Ha padecido cualquier otra enfermedad o lesión distinta a las mencionadas?</label>
          <div><label><input type="radio" name="otras_enfermedades" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="otras_enfermedades" value="No" checked> No</label></div>
          <input id="otras_enfermedades_just" name="otras_enfermedades_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Algún familiar cercano padece/ha padecido de diabetes, cáncer, problemas del corazón, tuberculosis?</label>
          <div><label><input type="radio" name="familiar_enfermedad" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="familiar_enfermedad" value="No" checked> No</label></div>
          <input id="familiar_enfermedad_just" name="familiar_enfermedad_just" type="text" placeholder="¿Cuáles? (justificación)" style="margin-top:6px;display:none" />
        </div>

        <div class="salav-field salav-full">
          <label>¿Padece ansiedad u otra enfermedad relacionada?</label>
          <div><label><input type="radio" name="padece_ansiedad" value="Sí"> Sí</label><label style="margin-left:8px"><input type="radio" name="padece_ansiedad" value="No" checked> No</label></div>
          <input id="padece_ansiedad_just" name="padece_ansiedad_just" type="text" placeholder="¿Cuál? (justificación)" style="margin-top:6px;display:none" />
        </div>
      </div>
    </div>

    <!-- CONTACTOS DE EMERGENCIA -->
    <div class="salav-card">
      <h2 class="section-title">Contactos de emergencia</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="emergencia1_nombre">En caso de emergencia avisar a (persona 1)</label>
          <input id="emergencia1_nombre" name="emergencia1_nombre" type="text" />
        </div>
        <div class="salav-field">
          <label for="emergencia1_parentesco">Parentesco</label>
          <input id="emergencia1_parentesco" name="emergencia1_parentesco" type="text" />
        </div>
        <div class="salav-field">
          <label for="emergencia1_telefono">Teléfono</label>
          <input id="emergencia1_telefono" name="emergencia1_telefono" type="text" />
        </div>

        <div class="salav-field">
          <label for="emergencia2_nombre">En caso de emergencia avisar a (persona 2)</label>
          <input id="emergencia2_nombre" name="emergencia2_nombre" type="text" />
        </div>
        <div class="salav-field">
          <label for="emergencia2_parentesco">Parentesco</label>
          <input id="emergencia2_parentesco" name="emergencia2_parentesco" type="text" />
        </div>
        <div class="salav-field">
          <label for="emergencia2_telefono">Teléfono</label>
          <input id="emergencia2_telefono" name="emergencia2_telefono" type="text" />
        </div>
      </div>
    </div>

    <!-- DOCUMENTACIÓN -->
    <div class="salav-card">
      <h2 class="section-title">Documentación (sube archivos relevantes)</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="cv">CV o solicitud de empleo</label>
          <div class="file-upload" id="cv-upload">
                <span>Haga clic para subir</span>
          <input id="cv" name="cv" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="cv-name"></div>
        </div>
        <div class="salav-field">
          <label for="comprobante_estudios">Último comprobante de estudios</label>
          <div class="file-upload" id="comprobante-upload">
                <span>Haga clic para subir</span>
          <input id="comprobante_estudios" name="comprobante_estudios" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="comprobante-name"></div>
        </div>
        <div class="salav-field">
          <label for="identificacion_oficial">Identificación oficial (INE, etc.)</label>
          <div class="file-upload" id="ine-upload">
                <span>Haga clic para subir</span>
          <input id="identificacion_oficial" name="identificacion_oficial" type="file" accept="image/*,application/pdf" />
          </div>
            <div class="file-name" id="ine-name"></div>
        </div>

        <div class="salav-field">
          <label for="cedula_profesional">Cédula profesional</label>
          <div class="file-upload" id="cedula-upload">
                <span>Haga clic para subir</span>
          <input id="cedula_profesional" name="cedula_profesional" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="cedula-name"></div>
        </div>
        <div class="salav-field">
          <label for="constancia_laboral">Constancia laboral (2)</label>
          <div class="file-upload" id="constancia-upload">
                <span>Haga clic para subir</span>
          <input id="constancia_laboral" name="constancia_laboral" type="file" accept="application/pdf,image/*" multiple />
          </div>
            <div class="file-name" id="constancia-name"></div>
        </div>
        <div class="salav-field">
          <label for="cartas_recomendacion">Cartas de recomendación personales (2)</label>
          <div class="file-upload" id="cartas-upload">
                <span>Haga clic para subir</span>
          <input id="cartas_recomendacion" name="cartas_recomendacion" type="file" accept="application/pdf,image/*" multiple />
          </div>
            <div class="file-name" id="cartas-name"></div>
        </div>

        <div class="salav-field">
          <label for="curp">CURP actualizado</label>
          <div class="file-upload" id="curp-upload">
                <span>Haga clic para subir</span>
          <input id="curp" name="curp" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="curp-name"></div>
        </div>
        <div class="salav-field">
          <label for="afore">AFORE</label>
          <div class="file-upload" id="afore-upload">
                <span>Haga clic para subir</span>
          <input id="afore" name="afore" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="afore-name"></div>
        </div>
        <div class="salav-field">
          <label for="constancia_fiscal">Constancia de situación fiscal</label>
          <div class="file-upload" id="fiscal-upload">
                <span>Haga clic para subir</span>
          <input id="constancia_fiscal" name="constancia_fiscal" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="fiscal-name"></div>
        </div>

        <div class="salav-field">
          <label for="licencia_manejo">Licencia de manejo</label>
          <div class="file-upload" id="licencia-upload">
                <span>Haga clic para subir</span>
          <input id="licencia_manejo" name="licencia_manejo" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="licencia-name"></div>
        </div>
        <div class="salav-field">
          <label for="comprobante_domicilio">Comprobante de domicilio (no mayor a 3 meses)</label>
          <div class="file-upload" id="domicilio-upload">
                <span>Haga clic para subir</span>
          <input id="comprobante_domicilio" name="comprobante_domicilio" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="domicilio-name"></div>
        </div>
        <div class="salav-field">
          <label for="constancia_nss">Constancia de localización del NSS</label>
          <div class="file-upload" id="nss-upload">
                <span>Haga clic para subir</span>
          <input id="constancia_nss" name="constancia_nss" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="nss-name"></div>
        </div>

        <div class="salav-field">
          <label for="acta_nacimiento_candidato">Acta de nacimiento del candidato</label>
          <div class="file-upload" id="nacimiento-upload">
                <span>Haga clic para subir</span>
          <input id="acta_nacimiento_candidato" name="acta_nacimiento_candidato" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="nacimiento-name"></div>
        </div>
        <div class="salav-field">
          <label for="acta_matrimonio">Acta de matrimonio</label>
          <div class="file-upload" id="matrimonio-upload">
                <span>Haga clic para subir</span>
          <input id="acta_matrimonio" name="acta_matrimonio" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="matrimonio-name"></div>
        </div>
        <div class="salav-field">
          <label for="acta_nacimiento_hijos">Acta de nacimiento de los hijos</label>
          <div class="file-upload" id="actahijo-upload">
                <span>Haga clic para subir</span>
          <input id="acta_nacimiento_hijos" name="acta_nacimiento_hijos" type="file" accept="application/pdf,image/*" multiple />
          </div>
            <div class="file-name" id="actahijo-name"></div>
        </div>
        <div class="salav-field">
          <label for="acta_nacimiento_conyuge">Acta de nacimiento del cónyuge</label>
          <div class="file-upload" id="actaconyuge-upload">
                <span>Haga clic para subir</span>
          <input id="acta_nacimiento_conyuge" name="acta_nacimiento_conyuge" type="file" accept="application/pdf,image/*" />
          </div>
            <div class="file-name" id="actaconyuge-name"></div>
        </div>
      </div>
    </div>

    <!-- CONCLUSIONES Y EVALUACIÓN FINAL -->
    <div class="salav-card">
      <h2 class="section-title">Conclusiones y evaluación final</h2>
      <div class="salav-grid">
        <div class="salav-field">
          <label for="info_coincide_final">¿La información que el candidato proporcionó coincide con lo observado en la visita?</label>
          <select id="info_coincide_final" name="info_coincide_final"><option>Sí</option><option>No</option></select>
        </div>

        <div class="salav-field">
          <label for="vivienda_corresponde">¿La vivienda corresponde al entorno que el candidato refiere?</label>
          <select id="vivienda_corresponde" name="vivienda_corresponde"><option>Sí</option><option>No</option></select>
        </div>

        <div class="salav-field">
          <label for="entorno_adecuado">¿El entorno socioeconómico del candidato es acorde a su puesto y sueldo?</label>
          <select id="entorno_adecuado" name="entorno_adecuado"><option>Sí</option><option>No</option></select>
        </div>

        <div class="salav-field">
          <label for="problemas_analisis">¿Se tuvo algún problema durante el proceso de análisis de la información? (¿Cuál?)</label>
          <input id="problemas_analisis" name="problemas_analisis" type="text" />
        </div>

        <div class="salav-field">
          <label for="problemas_visita">¿Se tuvo algún problema durante el proceso de visita al candidato? (¿Cuál?)</label>
          <input id="problemas_visita" name="problemas_visita" type="text" />
        </div>

        <div class="salav-field">
          <label for="problemas_agenda">¿Se tuvo algún problema durante el proceso de agenda de la investigación? (¿Cuál?)</label>
          <input id="problemas_agenda" name="problemas_agenda" type="text" />
        </div>

        <div class="salav-field">
          <label for="candidato_proporciono_toda_info">¿El candidato proporcionó toda la información solicitada?</label>
          <select id="candidato_proporciono_toda_info" name="candidato_proporciono_toda_info"><option>Sí</option><option>No</option></select>
        </div>

        <div class="salav-field">
          <label for="obtencion_info_dentro_domicilio">¿La obtención de información se realizó dentro del domicilio del candidato?</label>
          <select id="obtencion_info_dentro_domicilio" name="obtencion_info_dentro_domicilio"><option>Sí</option><option>No</option></select>
        </div>

        <div class="salav-field">
          <label for="actitud_candidato">¿El candidato mostró buena actitud para proporcionar la información?</label>
          <select id="actitud_candidato" name="actitud_candidato"><option>Sí</option><option>No</option></select>
        </div>
      </div>
    </div>

    <!-- Enviar -->
    <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:8px">
      <button type="submit" class="salav-btn-submit">Enviar formulario</button>
    </div>
  </form>
</section>

    </div>

  </plantilla-salav>

  <div id="modalAlert" class="modal">
        <div class="modal-contenido" id="modal-contenido">
        </div>
    </div>

  <script src="estudiosFormulario.css"></script>
  <script src="../../config.js"></script>
   <script src="../../utilities.js"></script>
  <script src="../../plantilla.js"></script>

  <script>
  /* -----------------------
     Helpers para DOM y creación dinámica
     ----------------------- */
  function el(tag, attrs = {}, children = []) {
    const node = document.createElement(tag);
    Object.entries(attrs).forEach(([k,v]) => {
      if (k === 'class') node.className = v;
      else if (k === 'html') node.innerHTML = v;
      else node.setAttribute(k, v);
    });
    children.forEach(c => node.appendChild(c));
    return node;
  }

  /* -----------------------
     Dinámicos: Familiares
     ----------------------- */
  const familiaresWrap = document.getElementById('familiares-wrap');
  let familiarCount = 0;
  function addFamiliar(prefill = {}) {
    familiarCount++;
    const id = 'fam_' + familiarCount;
    const container = el('div', { class: 'salav-field salav-full', id: id + '_wrap' });
    container.style.border = '1px dashed rgba(27,27,27,0.06)';
    container.style.padding = '10px';
    container.style.borderRadius = '8px';

    const innerGrid = el('div', { class: 'salav-grid' });

    // fields: nombre, edad, parentesco, estudios, ocupacion, empresa, telefono
    const fields = [
      {id:`${id}_nombre`, label:'Nombre', type:'text', class:'salav-field'},
      {id:`${id}_edad`, label:'Edad', type:'number', class:'salav-field'},
      {id:`${id}_parentesco`, label:'Parentesco', type:'text', class:'salav-field'},
      {id:`${id}_estudios`, label:'Último grado de estudios', type:'select', options:['','Primaria','Secundaria','Preparatoria','Licenciatura','Maestría','Doctorado'], class:'salav-field'},
      {id:`${id}_ocupacion`, label:'Ocupación', type:'text', class:'salav-field'},
      {id:`${id}_empresa`, label:'Empresa para la que trabaja', type:'text', class:'salav-field'},
      {id:`${id}_telefono`, label:'Teléfono', type:'text', class:'salav-field'}
    ];

    fields.forEach(f => {
      const fld = el('div', { class: f.class });
      const lbl = el('label', { for: f.id, html: f.label });
      fld.appendChild(lbl);
      if (f.type === 'select') {
        const s = el('select', { id: f.id, name: f.id });
        f.options.forEach(opt => {
          const op = document.createElement('option'); op.innerText = opt; if (opt === '') op.value = '';
          s.appendChild(op);
        });
        fld.appendChild(s);
      } else {
        const inp = el('input', { id: f.id, name: f.id, type: f.type });
        if (f.type === 'number') inp.min = 0;
        fld.appendChild(inp);
      }
      innerGrid.appendChild(fld);
    });

    const removeBtn = el('button', { type: 'button', class: 'btn salav-small-btn', html: 'Eliminar familiar' });
    removeBtn.style.marginTop = '8px';
    removeBtn.addEventListener('click', () => {
      familiaresWrap.removeChild(container);
    });

    container.appendChild(innerGrid);
    container.appendChild(removeBtn);
    familiaresWrap.appendChild(container);

    // prefill values if provided
    Object.entries(prefill).forEach(([k,v]) => {
      const elField = document.getElementById(`${id}_${k}`);
      if (elField) elField.value = v;
    });
  }

  document.getElementById('add-familiar-btn').addEventListener('click', () => addFamiliar());

  // añadir inicialmente 1 familiar vacío (opcional)
  // addFamiliar();

  /* -----------------------
     Dinámicos: Niveles académicos
     ----------------------- */
  const nivelesWrap = []; 
document.getElementById('add-nivel-btn').addEventListener('click', function() {
  const idx = Date.now(); 
  const wrapper = el('div', { class: 'salav-grid', id: `nivel_wrap_${idx}` });
  wrapper.style.border = '1px dashed rgba(27,27,27,0.06)';
  wrapper.style.padding = '10px';
  wrapper.style.borderRadius = '8px';
  wrapper.style.marginTop = '8px';

  // Campo: Último nivel académico 
  const nivelField = el('div', { class: 'salav-field' });
  nivelField.appendChild(el('label', { for: `ultimo_nivel_${idx}`, html: 'Último nivel académico' }));
  const select = el('select', { id: `ultimo_nivel_${idx}`, name: 'ultimo_nivel[]' });
  ['', 'Primaria','Secundaria','Preparatoria','Carrera técnica','Licenciatura','Maestría','Doctorado']
    .forEach(opt => {
      const o = document.createElement('option'); o.value = opt; o.text = opt || '--';
      select.appendChild(o);
    });
  nivelField.appendChild(select);

  // Campo: Institución
  const institField = el('div', { class: 'salav-field' });
  institField.appendChild(el('label', { for: `institucion_${idx}`, html: 'Institución' }));
  institField.appendChild(el('input', { id: `institucion_${idx}`, name: 'institucion[]', type: 'text' }));

  // Campo: Entidad federativa
  const entidadField = el('div', { class: 'salav-field' });
  entidadField.appendChild(el('label', { for: `entidad_federativa_${idx}`, html: 'Entidad federativa' }));
  entidadField.appendChild(el('input', { id: `entidad_federativa_${idx}`, name: 'entidad_federativa[]', type: 'text' }));

  // Campo: Documento recibido (full width)
  const docField = el('div', { class: 'salav-field salav-full' });
  docField.appendChild(el('label', { for: `documento_recibido_${idx}`, html: 'Documento recibido' }));
  docField.appendChild(el('input', { id: `documento_recibido_${idx}`, name: 'documento_recibido[]', type: 'text', placeholder: 'Ej: certificado, constancia, etc.' }));

  // Botón eliminar
  const remBtn = el('button', { type: 'button', class: 'btn salav-small-btn', html: 'Eliminar nivel' });
  remBtn.style.marginTop = '8px';
  remBtn.addEventListener('click', () => wrapper.remove());

  // Armado
  wrapper.appendChild(nivelField);
  wrapper.appendChild(institField);
  wrapper.appendChild(entidadField);
  wrapper.appendChild(docField);
  wrapper.appendChild(remBtn);

  // Insertar dentro de la sección (niveles-wrap)
  const nivelesContainer = document.getElementById('niveles-wrap');
  if (nivelesContainer) nivelesContainer.appendChild(wrapper);
  else document.querySelector('.salav-carousel form').insertBefore(wrapper, document.querySelector('.salav-carousel form').lastElementChild);
});



  /* -----------------------
     Cursos (dinámico)
     ----------------------- */
  const cursosWrap = document.getElementById('cursos-wrap');
  let cursoCount = 0;
  document.getElementById('add-curso-btn').addEventListener('click', () => {
    cursoCount++;
    const id = 'curso_' + cursoCount;
    const cont = el('div', { class: 'salav-grid', id: id+'_wrap' });
    cont.style.border = '1px dashed rgba(27,27,27,0.06)';
    cont.style.padding = '8px';
    cont.style.borderRadius = '8px';

    const nombre = el('div', { class: 'salav-field' });
    nombre.appendChild(el('label', { for: id+'_nombre', html: 'Nombre del curso o certificación' }));
    nombre.appendChild(el('input', { id: id+'_nombre', name: id+'_nombre', type:'text' }));

    const duracion = el('div', { class: 'salav-field' });
    duracion.appendChild(el('label', { for: id+'_duracion', html: 'Duración en horas' }));
    duracion.appendChild(el('input', { id: id+'_duracion', name: id+'_duracion', type:'number' }));

    const remove = el('button', { type:'button', class:'btn salav-small-btn', html:'Eliminar' });
    remove.addEventListener('click', () => cont.remove());

    cont.appendChild(nombre); cont.appendChild(duracion); cont.appendChild(remove);
    cursosWrap.appendChild(cont);
  });

  /* -----------------------
     Empresas (dinámico)
     ----------------------- */
  const empresasWrap = document.getElementById('empresas-wrap');
  let empresaCount = 0;
  document.getElementById('add-empresa-btn').addEventListener('click', () => {
    empresaCount++;
    const id = 'empresa_' + empresaCount;
    const cont = el('div',{class:'salav-grid', id:id+'_wrap'});
    cont.style.border='1px dashed rgba(27,27,27,0.06)'; cont.style.padding='8px'; cont.style.borderRadius='8px';

    const nombre = el('div',{class:'salav-field'}); nombre.appendChild(el('label',{for:id+'_nombre',html:'Nombre / Razón social'})); nombre.appendChild(el('input',{id:id+'_nombre',name:id+'_nombre',type:'text'}));
    const periodo = el('div',{class:'salav-field'}); periodo.appendChild(el('label',{for:id+'_periodo',html:'Periodo'})); periodo.appendChild(el('input',{id:id+'_periodo',name:id+'_periodo',type:'text'}));
    const prestaciones = el('div',{class:'salav-field'}); prestaciones.appendChild(el('label',{for:id+'_prestaciones',html:'Prestaciones con las que contaba'})); 
    const sel = el('select',{id:id+'_prestaciones',name:id+'_prestaciones'}); ['No contaba','Prestaciones de ley','Prestaciones superiores'].forEach(o=>{const op=document.createElement('option');op.innerText=o;sel.appendChild(op);});
    prestaciones.appendChild(sel);
    const motivo = el('div',{class:'salav-field'}); motivo.appendChild(el('label',{for:id+'_motivo',html:'Motivo de finalización'})); motivo.appendChild(el('input',{id:id+'_motivo',name:id+'_motivo',type:'text'}));
    const rem = el('button',{type:'button',class:'btn salav-small-btn',html:'Eliminar'}); rem.addEventListener('click',()=>cont.remove());

    cont.appendChild(nombre); cont.appendChild(periodo); cont.appendChild(prestaciones); cont.appendChild(motivo); cont.appendChild(rem);
    empresasWrap.appendChild(cont);
  });

  /* -----------------------
     Referencias (dinámicas por tipo)
     ----------------------- */
  function addReferencia(wrapId, tipo) {
    const wrap = document.getElementById(wrapId);
    const cont = el('div',{class:'salav-grid'});
    cont.style.border='1px dashed rgba(27,27,27,0.06)'; cont.style.padding='8px'; cont.style.borderRadius='8px';

    const nombre = el('div',{class:'salav-field'}); nombre.appendChild(el('label',{html:'Nombre'})); nombre.appendChild(el('input',{type:'text'}));
    const relacion = el('div',{class:'salav-field'}); relacion.appendChild(el('label',{html: tipo === 'laboral' ? 'Puesto' : 'Parentesco'})); relacion.appendChild(el('input',{type:'text'}));
    const telefono = el('div',{class:'salav-field'}); telefono.appendChild(el('label',{html:'Teléfono / WhatsApp'})); telefono.appendChild(el('input',{type:'text'}));
    const tiempo = el('div',{class:'salav-field'}); tiempo.appendChild(el('label',{html:'¿Tiempo de conocerse?'})); tiempo.appendChild(el('input',{type:'text'}));
    const rem = el('button',{type:'button',class:'btn salav-small-btn',html:'Eliminar'}); rem.addEventListener('click',()=>cont.remove());

    cont.appendChild(nombre); cont.appendChild(relacion); cont.appendChild(telefono); cont.appendChild(tiempo); cont.appendChild(rem);
    wrap.appendChild(cont);
  }

  document.getElementById('add-ref-personal').addEventListener('click', ()=> addReferencia('refs-personales-wrap','personal'));
  document.getElementById('add-ref-laboral').addEventListener('click', ()=> addReferencia('refs-laborales-wrap','laboral'));
  document.getElementById('add-ref-vecinal').addEventListener('click', ()=> addReferencia('refs-vecinal-wrap','vecinal'));
  document.getElementById('add-ref-familiar').addEventListener('click', ()=> addReferencia('refs-familiar-wrap','familiar'));

  /* -----------------------
     Conditional show/hide logic for vehicle / motorcycle / celular and study field and health justifications
     ----------------------- */
  function toggleDisplay(selector, show) {
    const el = typeof selector === 'string' ? document.querySelector(selector) : selector;
    if (!el) return;
    el.style.display = show ? '' : 'none';
  }

  // vehículo
  document.getElementById('tiene_vehiculo_si').addEventListener('change', ()=> toggleDisplay('#vehiculo-block', true));
  document.getElementById('tiene_vehiculo_no').addEventListener('change', ()=> toggleDisplay('#vehiculo-block', false));

  // motocicleta
  document.getElementById('cuenta_motocicleta').addEventListener('change', (e) => {
    toggleDisplay('#motocicleta-block', e.target.value === 'Sí');
  });

  // celular
  document.getElementById('cuenta_celular').addEventListener('change', (e) => {
    toggleDisplay('#celular-block', e.target.value === 'Sí');
  });

  // estudia actualmente
  document.querySelectorAll('input[name="estudia_actualmente"]').forEach(r => r.addEventListener('change', (e) => {
    toggleDisplay('#que_estudia_field', e.target.value === 'Sí');
  }));

  const healthPairs = [
    ['ha_consultado_medico', 'ha_consultado_medico_just'],
    ['ha_sufrido_cirugia', 'ha_sufrido_cirugia_just'],
    ['tiene_discapacidad', 'tiene_discapacidad_just'],
    ['practicado_estudios', 'practicado_estudios_just'],
    ['bajo_tratamiento', 'bajo_tratamiento_just'],
    ['transfusiones', 'transfusiones_just'],
    ['usa_drogas_prescripcion', 'usa_drogas_prescripcion_just'],
    ['enf_piel_sangre', 'enf_piel_sangre_just'],
    ['enf_ojo_oido', 'enf_ojo_oido_just'],
    ['enf_corazon', 'enf_corazon_just'],
    ['enf_pulmones', 'enf_pulmones_just'],
    ['enf_sistema_nervioso', 'enf_sistema_nervioso_just'],
    ['enf_glandular', 'enf_glandular_just'],
    ['enf_digestivo', 'enf_digestivo_just'],
    ['enf_musculo_esqueletico', 'enf_musculo_esqueletico_just'],
    ['enf_hernias', 'enf_hernias_just'],
    ['alergico_medicamento', 'alergico_medicamento_just'],
    ['otras_enfermedades', 'otras_enfermedades_just'],
    ['familiar_enfermedad', 'familiar_enfermedad_just'],
    ['padece_ansiedad', 'padece_ansiedad_just']
  ];
  healthPairs.forEach(([radioName, justId]) => {
    document.querySelectorAll(`input[name="${radioName}"]`).forEach(r => r.addEventListener('change', (e) => {
      toggleDisplay('#' + justId, e.target.value === 'Sí');
    }));
  });

  
  document.getElementById('salav-form').addEventListener('submit', function(e) {
    e.preventDefault();

    // variables independientes 
    const correo = document.getElementById('correo').value;
    const folio = document.getElementById('folio').value;
    const fecha_solicitud = document.getElementById('fecha_solicitud').value;
    const fecha_visita = document.getElementById('fecha_visita').value;
    const puesto = document.getElementById('puesto').value;
    const fotografia = document.getElementById('fotografia').files.length ? Array.from(document.getElementById('fotografia').files).map(f=>f.name) : null;

    const valuador_nombre = document.getElementById('valuador_nombre').value;

    const solicitante_razon2 = document.getElementById('solicitante_razon2').value;
    const solicitante_contacto = document.getElementById('solicitante_contacto').value;
    const solicitante_email = document.getElementById('solicitante_email').value;

    const candidato_nombre = document.getElementById('candidato_nombre').value;
    const edad = document.getElementById('edad').value;
    const fecha_nacimiento = document.getElementById('fecha_nacimiento').value;
    const rfc = document.getElementById('rfc').value;
    const telefono = document.getElementById('telefono').value;
    const telefono_recados = document.getElementById('telefono_recados').value;
    const lugar_nacimiento = document.getElementById('lugar_nacimiento').value;
    const estado = document.getElementById('estado').value;
    const pais = document.getElementById('pais').value;
    const estado_civil = document.getElementById('estado_civil').value;
    const num_hijos = document.getElementById('num_hijos').value;
    const direccion = document.getElementById('direccion').value;
    const colonia = document.getElementById('colonia').value;
    const ciudad = document.getElementById('ciudad').value;
    const codigo_postal = document.getElementById('codigo_postal').value;
    const familia_empresa = document.querySelector('input[name="familia_empresa"]:checked') ? document.querySelector('input[name="familia_empresa"]:checked').value : null;
    const nombre_familiar = document.getElementById('nombre_familiar').value;

    // croquis / fotos
    const croquis = document.getElementById('croquis').files.length ? Array.from(document.getElementById('croquis').files).map(f=>f.name) : null;
    const foto_fachada_exterior = document.getElementById('foto_fachada_exterior').files.length ? Array.from(document.getElementById('foto_fachada_exterior').files).map(f=>f.name) : null;
    const foto_fachada_interior = document.getElementById('foto_fachada_interior').files.length ? Array.from(document.getElementById('foto_fachada_interior').files).map(f=>f.name) : null;
    const foto_sala = document.getElementById('foto_sala').files.length ? Array.from(document.getElementById('foto_sala').files).map(f=>f.name) : null;
    const foto_entregando_documentos = document.getElementById('foto_entregando_documentos').files.length ? Array.from(document.getElementById('foto_entregando_documentos').files).map(f=>f.name) : null;

    // familiares: leer dinámicos
    const familiares = [];
    document.querySelectorAll('#familiares-wrap > div').forEach((wrap, idx) => {
      const pref = {
        nombre: wrap.querySelector('input[id$="_nombre"]') ? wrap.querySelector('input[id$="_nombre"]').value : '',
        edad: wrap.querySelector('input[id$="_edad"]') ? wrap.querySelector('input[id$="_edad"]').value : '',
        parentesco: wrap.querySelector('input[id$="_parentesco"]') ? wrap.querySelector('input[id$="_parentesco"]').value : '',
        estudios: wrap.querySelector('select[id$="_estudios"]') ? wrap.querySelector('select[id$="_estudios"]').value : '',
        ocupacion: wrap.querySelector('input[id$="_ocupacion"]') ? wrap.querySelector('input[id$="_ocupacion"]').value : '',
        empresa: wrap.querySelector('input[id$="_empresa"]') ? wrap.querySelector('input[id$="_empresa"]').value : '',
        telefono: wrap.querySelector('input[id$="_telefono"]') ? wrap.querySelector('input[id$="_telefono"]').value : ''
      };
      familiares.push(pref);
    });

    // economía
    const sueldo_actual = document.getElementById('sueldo_actual').value;
    const ingresos_negocio = document.getElementById('ingresos_negocio').value;
    const ingresos_oficio = document.getElementById('ingresos_oficio').value;
    const otros_ingresos = document.getElementById('otros_ingresos').value;
    const ingresos_conyuge = document.getElementById('ingresos_conyuge').value;
    const ingresos_padres = document.getElementById('ingresos_padres').value;
    const ingresos_hijos = document.getElementById('ingresos_hijos').value;
    const ingresos_hermanos = document.getElementById('ingresos_hermanos').value;
    const otros_ingresos_familiares = document.getElementById('otros_ingresos_familiares').value;

    // gastos traslado
    const gasto_pasajes = document.getElementById('gasto_pasajes').value;
    const gasto_taxi = document.getElementById('gasto_taxi').value;
    const gasto_gasolina = document.getElementById('gasto_gasolina').value;
    const gasto_casetas = document.getElementById('gasto_casetas').value;

    // egresos mensuales
    const gasto_alimentacion = document.getElementById('gasto_alimentacion').value;
    const gasto_agua_potable = document.getElementById('gasto_agua_potable').value;
    const gasto_luz = document.getElementById('gasto_luz').value;
    const gasto_internet = document.getElementById('gasto_internet').value;
    const gasto_telefonia = document.getElementById('gasto_telefonia').value;
    const gasto_streaming = document.getElementById('gasto_streaming').value;
    const gasto_mantenimiento_hogar = document.getElementById('gasto_mantenimiento_hogar').value;
    const gasto_mantenimiento_vehicular = document.getElementById('gasto_mantenimiento_vehicular').value;
    const gasto_pension_alimenticia = document.getElementById('gasto_pension_alimenticia').value;
    const gasto_salidas_recreativas = document.getElementById('gasto_salidas_recreativas').value;
    const gasto_membresias = document.getElementById('gasto_membresias').value;
    const gasto_seguros_vida = document.getElementById('gasto_seguros_vida').value;
    const gasto_seguro_vehiculo = document.getElementById('gasto_seguro_vehiculo').value;
    const gasto_credito_vivienda = document.getElementById('gasto_credito_vivienda').value;
    const gasto_credito_vehicular = document.getElementById('gasto_credito_vehicular').value;
    const gasto_hipoteca = document.getElementById('gasto_hipoteca').value;
    const gasto_mascotas = document.getElementById('gasto_mascotas').value;
    const gasto_consultas_medicas = document.getElementById('gasto_consultas_medicas').value;
    const gasto_educacion = document.getElementById('gasto_educacion').value;
    const gasto_ropa_calzado = document.getElementById('gasto_ropa_calzado').value;

    // comodidades (vehiculo)
    const tiene_vehiculo = document.querySelector('input[name="tiene_vehiculo"]:checked') ? document.querySelector('input[name="tiene_vehiculo"]:checked').value : 'No';
    const veh_marca = document.getElementById('veh_marca').value;
    const veh_modelo = document.getElementById('veh_modelo').value;
    const veh_ano = document.getElementById('veh_ano').value;
    const veh_color = document.getElementById('veh_color').value;

    // comodidades 2
    const cuenta_computadora = document.getElementById('cuenta_computadora').value;
    const cuenta_bicicleta = document.getElementById('cuenta_bicicleta').value;
    const cuenta_tablet = document.getElementById('cuenta_tablet').value;
    const cuenta_refri = document.getElementById('cuenta_refri').value;
    const cuenta_tv = document.getElementById('cuenta_tv').value;
    const cuenta_microondas = document.getElementById('cuenta_microondas').value;
    const cuenta_estufa = document.getElementById('cuenta_estufa').value;
    const cuenta_lavadora = document.getElementById('cuenta_lavadora').value;
    const cuenta_motocicleta = document.getElementById('cuenta_motocicleta').value;

    // motocicleta details
    const moto_marca = document.getElementById('moto_marca').value;
    const moto_modelo = document.getElementById('moto_modelo').value;
    const moto_ano = document.getElementById('moto_ano').value;
    const moto_color = document.getElementById('moto_color').value;

    // comodidades 3
    const cuenta_camara = document.getElementById('cuenta_camara').value;
    const cuenta_freidora = document.getElementById('cuenta_freidora').value;
    const cuenta_horno_electrico = document.getElementById('cuenta_horno_electrico').value;
    const cuenta_batidora = document.getElementById('cuenta_batidora').value;
    const cuenta_tostador = document.getElementById('cuenta_tostador').value;
    const cuenta_dispensador = document.getElementById('cuenta_dispensador').value;
    const cuenta_licuadora = document.getElementById('cuenta_licuadora').value;
    const cuenta_tanque_gas = document.getElementById('cuenta_tanque_gas').value;
    const cuenta_celular = document.getElementById('cuenta_celular').value;

    // celular
    const cel_marca = document.getElementById('cel_marca').value;
    const cel_modelo = document.getElementById('cel_modelo').value;

    // comodidades 4
    const cuenta_cama = document.getElementById('cuenta_cama').value;
    const cuenta_sala = document.getElementById('cuenta_sala').value;
    const cuenta_cocina_integral = document.getElementById('cuenta_cocina_integral').value;
    const cuenta_closet = document.getElementById('cuenta_closet').value;
    const cuenta_banio = document.getElementById('cuenta_banio').value;
    const cuenta_calentador_solar = document.getElementById('cuenta_calentador_solar').value;
    const cuenta_calentador_boiler = document.getElementById('cuenta_calentador_boiler').value;
    const cuenta_panel_solar = document.getElementById('cuenta_panel_solar').value;

    // servicios zona
    const agua_potable = document.getElementById('agua_potable').value;
    const energia_electrica = document.getElementById('energia_electrica').value;
    const drenaje = document.getElementById('drenaje').value;
    const pavimentacion = document.getElementById('pavimentacion').value;
    const alumbrado_publico = document.getElementById('alumbrado_publico').value;
    const lineas_telefonicas = document.getElementById('lineas_telefonicas').value;
    const lineas_internet = document.getElementById('lineas_internet').value;
    const lineas_gas = document.getElementById('lineas_gas').value;
    const lineas_cable = document.getElementById('lineas_cable').value;
    const hospitales = document.getElementById('hospitales').value;
    const escuelas = document.getElementById('escuelas').value;
    const centros_comerciales = document.getElementById('centros_comerciales').value;
    const club_social_colonia = document.getElementById('club_social_colonia').value;
    const parques_recreativos = document.getElementById('parques_recreativos').value;
    const recoleccion_residuos = document.getElementById('recoleccion_residuos').value;
    const transporte_publico = document.getElementById('transporte_publico').value;
    const cuenta_metro = document.getElementById('cuenta_metro').value;
    const cuenta_teleferico = document.getElementById('cuenta_teleferico').value;

    // academicos base
    const ultimo_nivel = document.getElementById('ultimo_nivel').value;
    const institucion = document.getElementById('institucion').value;
    const entidad_federativa = document.getElementById('entidad_federativa').value;
    const documento_recibido = document.getElementById('documento_recibido').value;

    // datos academicos actuales
    const estudia_actualmente = document.querySelector('input[name="estudia_actualmente"]:checked') ? document.querySelector('input[name="estudia_actualmente"]:checked').value : 'No';
    const que_estudia = document.getElementById('que_estudia') ? document.getElementById('que_estudia').value : '';

    // cursos 
    const cursos = [];
    document.querySelectorAll('#cursos-wrap > div').forEach(c => {
      cursos.push({
        nombre: c.querySelector('input[type="text"]') ? c.querySelector('input[type="text"]').value : '',
        duracion_horas: c.querySelector('input[type="number"]') ? c.querySelector('input[type="number"]').value : ''
      });
    });

    // investigacion laboral 
    const empresas = [];
    document.querySelectorAll('#empresas-wrap > div').forEach(e => {
      empresas.push({
        nombre: e.querySelector('input[id$="_nombre"]') ? e.querySelector('input[id$="_nombre"]').value : '',
        periodo: e.querySelector('input[id$="_periodo"]') ? e.querySelector('input[id$="_periodo"]').value : '',
        prestaciones: e.querySelector('select[id$="_prestaciones"]') ? e.querySelector('select[id$="_prestaciones"]').value : '',
        motivo_fin: e.querySelector('input[id$="_motivo"]') ? e.querySelector('input[id$="_motivo"]').value : ''
      });
    });

    // referencias (por tipo)
    function readRefs(wrapperId) {
      const arr = [];
      document.querySelectorAll(`#${wrapperId} > div`).forEach(r => {
        const inputs = r.querySelectorAll('input');
        arr.push({
          nombre: inputs[0] ? inputs[0].value : '',
          relacion: inputs[1] ? inputs[1].value : '',
          telefono: inputs[2] ? inputs[2].value : '',
          tiempo_conocerse: inputs[3] ? inputs[3].value : ''
        });
      });
      return arr;
    }
    const refs_personales = readRefs('refs-personales-wrap');
    const refs_laborales = readRefs('refs-laborales-wrap');
    const refs_vecinal = readRefs('refs-vecinal-wrap');
    const refs_familiar = readRefs('refs-familiar-wrap');

    // salud: valores y justificaciones
    const nss = document.getElementById('nss').value;
    const tipo_sangre = document.getElementById('tipo_sangre').value;
    const estatura = document.getElementById('estatura').value;
    const peso = document.getElementById('peso').value;
    const utiliza_lentes = document.querySelector('input[name="utiliza_lentes"]:checked') ? document.querySelector('input[name="utiliza_lentes"]:checked').value : 'No';
    const justificacion_lentes = document.getElementById('justificacion_lentes').value;

    const health = {};
    health.ha_consultado_medico = document.querySelector('input[name="ha_consultado_medico"]:checked') ? document.querySelector('input[name="ha_consultado_medico"]:checked').value : 'No';
    health.ha_consultado_medico_just = document.getElementById('ha_consultado_medico_just').value;
    health.ha_sufrido_cirugia = document.querySelector('input[name="ha_sufrido_cirugia"]:checked') ? document.querySelector('input[name="ha_sufrido_cirugia"]:checked').value : 'No';
    health.ha_sufrido_cirugia_just = document.getElementById('ha_sufrido_cirugia_just').value;
    health.tiene_discapacidad = document.querySelector('input[name="tiene_discapacidad"]:checked') ? document.querySelector('input[name="tiene_discapacidad"]:checked').value : 'No';
    health.tiene_discapacidad_just = document.getElementById('tiene_discapacidad_just').value;
    health.practicado_estudios = document.querySelector('input[name="practicado_estudios"]:checked') ? document.querySelector('input[name="practicado_estudios"]:checked').value : 'No';
    health.practicado_estudios_just = document.getElementById('practicado_estudios_just').value;
    health.bajo_tratamiento = document.querySelector('input[name="bajo_tratamiento"]:checked') ? document.querySelector('input[name="bajo_tratamiento"]:checked').value : 'No';
    health.bajo_tratamiento_just = document.getElementById('bajo_tratamiento_just').value;
    health.transfusiones = document.querySelector('input[name="transfusiones"]:checked') ? document.querySelector('input[name="transfusiones"]:checked').value : 'No';
    health.transfusiones_just = document.getElementById('transfusiones_just').value;
    health.usa_drogas_prescripcion = document.querySelector('input[name="usa_drogas_prescripcion"]:checked') ? document.querySelector('input[name="usa_drogas_prescripcion"]:checked').value : 'No';
    health.usa_drogas_prescripcion_just = document.getElementById('usa_drogas_prescripcion_just').value;
    health.enf_piel_sangre = document.querySelector('input[name="enf_piel_sangre"]:checked') ? document.querySelector('input[name="enf_piel_sangre"]:checked').value : 'No';
    health.enf_piel_sangre_just = document.getElementById('enf_piel_sangre_just').value;
    health.enf_ojo_oido = document.querySelector('input[name="enf_ojo_oido"]:checked') ? document.querySelector('input[name="enf_ojo_oido"]:checked').value : 'No';
    health.enf_ojo_oido_just = document.getElementById('enf_ojo_oido_just').value;
    health.enf_corazon = document.querySelector('input[name="enf_corazon"]:checked') ? document.querySelector('input[name="enf_corazon"]:checked').value : 'No';
    health.enf_corazon_just = document.getElementById('enf_corazon_just').value;
    health.enf_pulmones = document.querySelector('input[name="enf_pulmones"]:checked') ? document.querySelector('input[name="enf_pulmones"]:checked').value : 'No';
    health.enf_pulmones_just = document.getElementById('enf_pulmones_just').value;
    health.enf_sistema_nervioso = document.querySelector('input[name="enf_sistema_nervioso"]:checked') ? document.querySelector('input[name="enf_sistema_nervioso"]:checked').value : 'No';
    health.enf_sistema_nervioso_just = document.getElementById('enf_sistema_nervioso_just').value;
    health.enf_glandular = document.querySelector('input[name="enf_glandular"]:checked') ? document.querySelector('input[name="enf_glandular"]:checked').value : 'No';
    health.enf_glandular_just = document.getElementById('enf_glandular_just').value;
    health.enf_digestivo = document.querySelector('input[name="enf_digestivo"]:checked') ? document.querySelector('input[name="enf_digestivo"]:checked').value : 'No';
    health.enf_digestivo_just = document.getElementById('enf_digestivo_just').value;
    health.enf_musculo_esqueletico = document.querySelector('input[name="enf_musculo_esqueletico"]:checked') ? document.querySelector('input[name="enf_musculo_esqueletico"]:checked').value : 'No';
    health.enf_musculo_esqueletico_just = document.getElementById('enf_musculo_esqueletico_just').value;
    health.enf_hernias = document.querySelector('input[name="enf_hernias"]:checked') ? document.querySelector('input[name="enf_hernias"]:checked').value : 'No';
    health.enf_hernias_just = document.getElementById('enf_hernias_just').value;
    health.alergico_medicamento = document.querySelector('input[name="alergico_medicamento"]:checked') ? document.querySelector('input[name="alergico_medicamento"]:checked').value : 'No';
    health.alergico_medicamento_just = document.getElementById('alergico_medicamento_just').value;
    health.otras_enfermedades = document.querySelector('input[name="otras_enfermedades"]:checked') ? document.querySelector('input[name="otras_enfermedades"]:checked').value : 'No';
    health.otras_enfermedades_just = document.getElementById('otras_enfermedades_just').value;
    health.familiar_enfermedad = document.querySelector('input[name="familiar_enfermedad"]:checked') ? document.querySelector('input[name="familiar_enfermedad"]:checked').value : 'No';
    health.familiar_enfermedad_just = document.getElementById('familiar_enfermedad_just').value;
    health.padece_ansiedad = document.querySelector('input[name="padece_ansiedad"]:checked') ? document.querySelector('input[name="padece_ansiedad"]:checked').value : 'No';
    health.padece_ansiedad_just = document.getElementById('padece_ansiedad_just').value;

    // documentos (nombres de archivos)
    function filesList(id){ return document.getElementById(id) && document.getElementById(id).files.length ? Array.from(document.getElementById(id).files).map(f=>f.name) : null; }
    const cv = filesList('cv');
    const comprobante_estudios = filesList('comprobante_estudios');
    const identificacion_oficial = filesList('identificacion_oficial');
    const cedula_profesional = filesList('cedula_profesional');
    const constancia_laboral = filesList('constancia_laboral');
    const cartas_recomendacion = filesList('cartas_recomendacion');
    const curp = filesList('curp');
    const afore = filesList('afore');
    const constancia_fiscal = filesList('constancia_fiscal');
    const licencia_manejo = filesList('licencia_manejo');
    const comprobante_domicilio = filesList('comprobante_domicilio');
    const constancia_nss = filesList('constancia_nss');
    const acta_nacimiento_candidato = filesList('acta_nacimiento_candidato');
    const acta_matrimonio = filesList('acta_matrimonio');
    const acta_nacimiento_hijos = filesList('acta_nacimiento_hijos');
    const acta_nacimiento_conyuge = filesList('acta_nacimiento_conyuge');

    // conclusiones
    const info_coincide_final = document.getElementById('info_coincide_final').value;
    const vivienda_corresponde = document.getElementById('vivienda_corresponde').value;
    const entorno_adecuado = document.getElementById('entorno_adecuado').value;
    const problemas_analisis = document.getElementById('problemas_analisis').value;
    const problemas_visita = document.getElementById('problemas_visita').value;
    const problemas_agenda = document.getElementById('problemas_agenda').value;
    const candidato_proporciono_toda_info = document.getElementById('candidato_proporciono_toda_info').value;
    const obtencion_info_dentro_domicilio = document.getElementById('obtencion_info_dentro_domicilio').value;
    const actitud_candidato = document.getElementById('actitud_candidato').value;

    console.log('correo:', correo);
    console.log('folio:', folio);
    console.log('fecha_solicitud:', fecha_solicitud);
    console.log('fecha_visita:', fecha_visita);
    console.log('puesto:', puesto);
    console.log('fotografia:', fotografia);

    console.log('valuador_nombre:', valuador_nombre);

    console.log('solicitante_razon2:', solicitante_razon2);
    console.log('solicitante_contacto:', solicitante_contacto);
    console.log('solicitante_email:', solicitante_email);

    console.log('candidato_nombre:', candidato_nombre);
    console.log('edad:', edad);
    console.log('fecha_nacimiento:', fecha_nacimiento);
    console.log('rfc:', rfc);
    console.log('telefono:', telefono);
    console.log('telefono_recados:', telefono_recados);
    console.log('lugar_nacimiento:', lugar_nacimiento);
    console.log('estado:', estado);
    console.log('pais:', pais);
    console.log('estado_civil:', estado_civil);
    console.log('num_hijos:', num_hijos);
    console.log('direccion:', direccion);
    console.log('colonia:', colonia);
    console.log('ciudad:', ciudad);
    console.log('codigo_postal:', codigo_postal);
    console.log('familia_empresa:', familia_empresa);
    console.log('nombre_familiar:', nombre_familiar);

    console.log('croquis:', croquis);
    console.log('foto_fachada_exterior:', foto_fachada_exterior);
    console.log('foto_fachada_interior:', foto_fachada_interior);
    console.log('foto_sala:', foto_sala);
    console.log('foto_entregando_documentos:', foto_entregando_documentos);

    // imprimir familiares individualmente
    familiares.forEach((f, i) => {
      console.log(`familiar_${i+1}_nombre:`, f.nombre);
      console.log(`familiar_${i+1}_edad:`, f.edad);
      console.log(`familiar_${i+1}_parentesco:`, f.parentesco);
      console.log(`familiar_${i+1}_estudios:`, f.estudios);
      console.log(`familiar_${i+1}_ocupacion:`, f.ocupacion);
      console.log(`familiar_${i+1}_empresa:`, f.empresa);
      console.log(`familiar_${i+1}_telefono:`, f.telefono);
    });

    // imprimir economía/gastos
    console.log('sueldo_actual:', sueldo_actual);
    console.log('ingresos_negocio:', ingresos_negocio);
    console.log('ingresos_oficio:', ingresos_oficio);
    console.log('otros_ingresos:', otros_ingresos);
    console.log('ingresos_conyuge:', ingresos_conyuge);
    console.log('ingresos_padres:', ingresos_padres);
    console.log('ingresos_hijos:', ingresos_hijos);
    console.log('ingresos_hermanos:', ingresos_hermanos);
    console.log('otros_ingresos_familiares:', otros_ingresos_familiares);

    console.log('gasto_pasajes:', gasto_pasajes);
    console.log('gasto_taxi:', gasto_taxi);
    console.log('gasto_gasolina:', gasto_gasolina);
    console.log('gasto_casetas:', gasto_casetas);

    console.log('gasto_alimentacion:', gasto_alimentacion);
    console.log('gasto_agua_potable:', gasto_agua_potable);
    console.log('gasto_luz:', gasto_luz);
    console.log('gasto_internet:', gasto_internet);
    console.log('gasto_telefonia:', gasto_telefonia);
    console.log('gasto_streaming:', gasto_streaming);
    console.log('gasto_mantenimiento_hogar:', gasto_mantenimiento_hogar);
    console.log('gasto_mantenimiento_vehicular:', gasto_mantenimiento_vehicular);
    console.log('gasto_pension_alimenticia:', gasto_pension_alimenticia);
    console.log('gasto_salidas_recreativas:', gasto_salidas_recreativas);
    console.log('gasto_membresias:', gasto_membresias);
    console.log('gasto_seguros_vida:', gasto_seguros_vida);
    console.log('gasto_seguro_vehiculo:', gasto_seguro_vehiculo);
    console.log('gasto_credito_vivienda:', gasto_credito_vivienda);
    console.log('gasto_credito_vehicular:', gasto_credito_vehicular);
    console.log('gasto_hipoteca:', gasto_hipoteca);
    console.log('gasto_mascotas:', gasto_mascotas);
    console.log('gasto_consultas_medicas:', gasto_consultas_medicas);
    console.log('gasto_educacion:', gasto_educacion);
    console.log('gasto_ropa_calzado:', gasto_ropa_calzado);

    // comodidades
    console.log('tiene_vehiculo:', tiene_vehiculo);
    console.log('veh_marca:', veh_marca);
    console.log('veh_modelo:', veh_modelo);
    console.log('veh_ano:', veh_ano);
    console.log('veh_color:', veh_color);

    console.log('cuenta_computadora:', cuenta_computadora);
    console.log('cuenta_bicicleta:', cuenta_bicicleta);
    console.log('cuenta_tablet:', cuenta_tablet);
    console.log('cuenta_refri:', cuenta_refri);
    console.log('cuenta_tv:', cuenta_tv);
    console.log('cuenta_microondas:', cuenta_microondas);
    console.log('cuenta_estufa:', cuenta_estufa);
    console.log('cuenta_lavadora:', cuenta_lavadora);
    console.log('cuenta_motocicleta:', cuenta_motocicleta);

    console.log('moto_marca:', moto_marca);
    console.log('moto_modelo:', moto_modelo);
    console.log('moto_ano:', moto_ano);
    console.log('moto_color:', moto_color);

    console.log('cuenta_camara:', cuenta_camara);
    console.log('cuenta_freidora:', cuenta_freidora);
    console.log('cuenta_horno_electrico:', cuenta_horno_electrico);
    console.log('cuenta_batidora:', cuenta_batidora);
    console.log('cuenta_tostador:', cuenta_tostador);
    console.log('cuenta_dispensador:', cuenta_dispensador);
    console.log('cuenta_licuadora:', cuenta_licuadora);
    console.log('cuenta_tanque_gas:', cuenta_tanque_gas);
    console.log('cuenta_celular:', cuenta_celular);

    console.log('cel_marca:', cel_marca);
    console.log('cel_modelo:', cel_modelo);

    console.log('cuenta_cama:', cuenta_cama);
    console.log('cuenta_sala:', cuenta_sala);
    console.log('cuenta_cocina_integral:', cuenta_cocina_integral);
    console.log('cuenta_closet:', cuenta_closet);
    console.log('cuenta_banio:', cuenta_banio);
    console.log('cuenta_calentador_solar:', cuenta_calentador_solar);
    console.log('cuenta_calentador_boiler:', cuenta_calentador_boiler);
    console.log('cuenta_panel_solar:', cuenta_panel_solar);

    console.log('agua_potable:', agua_potable);
    console.log('energia_electrica:', energia_electrica);
    console.log('drenaje:', drenaje);
    console.log('pavimentacion:', pavimentacion);
    console.log('alumbrado_publico:', alumbrado_publico);
    console.log('lineas_telefonicas:', lineas_telefonicas);
    console.log('lineas_internet:', lineas_internet);
    console.log('lineas_gas:', lineas_gas);
    console.log('lineas_cable:', lineas_cable);
    console.log('hospitales:', hospitales);
    console.log('escuelas:', escuelas);
    console.log('centros_comerciales:', centros_comerciales);
    console.log('club_social_colonia:', club_social_colonia);
    console.log('parques_recreativos:', parques_recreativos);
    console.log('recoleccion_residuos:', recoleccion_residuos);
    console.log('transporte_publico:', transporte_publico);
    console.log('cuenta_metro:', cuenta_metro);
    console.log('cuenta_teleferico:', cuenta_teleferico);

    console.log('ultimo_nivel:', ultimo_nivel);
    console.log('institucion:', institucion);
    console.log('entidad_federativa:', entidad_federativa);
    console.log('documento_recibido:', documento_recibido);

    console.log('estudia_actualmente:', estudia_actualmente);
    console.log('que_estudia:', que_estudia);

    // cursos
    cursos.forEach((c,i) => {
      console.log(`curso_${i+1}_nombre:`, c.nombre);
      console.log(`curso_${i+1}_duracion_horas:`, c.duracion_horas);
    });

    // empresas (laboral)
    empresas.forEach((e,i) => {
      console.log(`empresa_${i+1}_nombre:`, e.nombre);
      console.log(`empresa_${i+1}_periodo:`, e.periodo);
      console.log(`empresa_${i+1}_prestaciones:`, e.prestaciones);
      console.log(`empresa_${i+1}_motivo_fin:`, e.motivo_fin);
    });

    // referencias
    refs_personales.forEach((r,i)=> console.log(`ref_personal_${i+1}:`, r));
    refs_laborales.forEach((r,i)=> console.log(`ref_laboral_${i+1}:`, r));
    refs_vecinal.forEach((r,i)=> console.log(`ref_vecinal_${i+1}:`, r));
    refs_familiar.forEach((r,i)=> console.log(`ref_familiar_${i+1}:`, r));

    // salud
    console.log('nss:', nss);
    console.log('tipo_sangre:', tipo_sangre);
    console.log('estatura:', estatura);
    console.log('peso:', peso);
    console.log('utiliza_lentes:', utiliza_lentes);
    console.log('justificacion_lentes:', justificacion_lentes);
    console.log('health detalle:', health);

    // documentos
    console.log('cv:', cv);
    console.log('comprobante_estudios:', comprobante_estudios);
    console.log('identificacion_oficial:', identificacion_oficial);
    console.log('cedula_profesional:', cedula_profesional);
    console.log('constancia_laboral:', constancia_laboral);
    console.log('cartas_recomendacion:', cartas_recomendacion);
    console.log('curp:', curp);
    console.log('afore:', afore);
    console.log('constancia_fiscal:', constancia_fiscal);
    console.log('licencia_manejo:', licencia_manejo);
    console.log('comprobante_domicilio:', comprobante_domicilio);
    console.log('constancia_nss:', constancia_nss);
    console.log('acta_nacimiento_candidato:', acta_nacimiento_candidato);
    console.log('acta_matrimonio:', acta_matrimonio);
    console.log('acta_nacimiento_hijos:', acta_nacimiento_hijos);
    console.log('acta_nacimiento_conyuge:', acta_nacimiento_conyuge);

    // conclusiones
    console.log('info_coincide_final:', info_coincide_final);
    console.log('vivienda_corresponde:', vivienda_corresponde);
    console.log('entorno_adecuado:', entorno_adecuado);
    console.log('problemas_analisis:', problemas_analisis);
    console.log('problemas_visita:', problemas_visita);
    console.log('problemas_agenda:', problemas_agenda);
    console.log('candidato_proporciono_toda_info:', candidato_proporciono_toda_info);
    console.log('obtencion_info_dentro_domicilio:', obtencion_info_dentro_domicilio);
    console.log('actitud_candidato:', actitud_candidato);

    /* -----------------------
       JSON completo
       ----------------------- */
    const formJSON = {
      meta: { generado_en: new Date().toISOString() },
      datos_generales: { correo, folio, fecha_solicitud, fecha_visita, puesto, fotografia },
      empresa_valuadora: { valuador_nombre},
      empresa_solicitante: { solicitante_razon2, solicitante_contacto, solicitante_email },
      candidato: { candidato_nombre, edad, fecha_nacimiento, rfc, telefono, telefono_recados, lugar_nacimiento, estado, pais, estado_civil, num_hijos, direccion, colonia, ciudad, codigo_postal, familia_empresa, nombre_familiar },
      croquis: croquis,
      fotos_domicilio: { foto_fachada_exterior, foto_fachada_interior, foto_sala, foto_entregando_documentos },
      familiares: familiares,
      situacion_economica: {
        estilo_vida: { sueldo_actual, ingresos_negocio, ingresos_oficio, otros_ingresos },
        ingresos_familiares: { ingresos_conyuge, ingresos_padres, ingresos_hijos, ingresos_hermanos, otros_ingresos_familiares },
        gastos_traslado: { gasto_pasajes, gasto_taxi, gasto_gasolina, gasto_casetas },
        egresos_mensuales_candidato: {
          gasto_alimentacion, gasto_agua_potable, gasto_luz, gasto_internet, gasto_telefonia, gasto_streaming, gasto_mantenimiento_hogar,
          gasto_mantenimiento_vehicular, gasto_pension_alimenticia, gasto_salidas_recreativas,
          gasto_membresias, gasto_seguros_vida, gasto_seguro_vehiculo, gasto_credito_vivienda,
          gasto_credito_vehicular, gasto_hipoteca, gasto_mascotas, gasto_consultas_medicas,
          gasto_educacion, gasto_ropa_calzado
        }
      },
      comodidades: {
        tiene_vehiculo, veh_marca, veh_modelo, veh_ano, veh_color,
        cuenta_computadora, cuenta_bicicleta, cuenta_tablet, cuenta_refri,  cuenta_tv, cuenta_microondas,
        cuenta_estufa, cuenta_lavadora, cuenta_motocicleta,
        motocicleta: { moto_marca, moto_modelo, moto_ano, moto_color },
        aparatos: { cuenta_camara, cuenta_freidora, cuenta_horno_electrico, cuenta_batidora, cuenta_tostador, cuenta_dispensador, cuenta_licuadora, cuenta_tanque_gas, cuenta_celular },
        celular: { cel_marca, cel_modelo },
        hogar: { cuenta_cama, cuenta_sala, cuenta_cocina_integral, cuenta_closet, cuenta_banio, cuenta_calentador_solar, cuenta_calentador_boiler, cuenta_panel_solar }
      },
      servicios_zona: {
        agua_potable, energia_electrica, drenaje, pavimentacion, alumbrado_publico, lineas_telefonicas, lineas_internet, lineas_gas, lineas_cable, escuelas, hospitales, centros_comerciales, club_social_colonia, parques_recreativos, recoleccion_residuos, transporte_publico, cuenta_metro, cuenta_teleferico
      },
      academicos: { ultimo_nivel, institucion, entidad_federativa, documento_recibido, estudia_actualmente, que_estudia, cursos },
      investigacion_laboral: empresas,
      referencias: { personales: refs_personales, laborales: refs_laborales, vecinal: refs_vecinal, familiar: refs_familiar },
      salud: { nss, tipo_sangre, estatura, peso, utiliza_lentes, justificacion_lentes, detalles: health },
      documentos: { cv, comprobante_estudios, identificacion_oficial, cedula_profesional, constancia_laboral, cartas_recomendacion, curp, afore, constancia_fiscal, licencia_manejo, comprobante_domicilio, constancia_nss, acta_nacimiento_candidato, acta_matrimonio, acta_nacimiento_hijos, acta_nacimiento_conyuge },
      conclusiones: { info_coincide_final, vivienda_corresponde, entorno_adecuado, problemas_analisis, problemas_visita, problemas_agenda, candidato_proporciono_toda_info, obtencion_info_dentro_domicilio, actitud_candidato }
    };

    const niveles = [];
    document.querySelectorAll('#niveles-wrap > div').forEach(w => {
    const idSuffix = w.id.split('_').pop();
    niveles.push({
        ultimo_nivel: document.getElementById(`ultimo_nivel_${idSuffix}`) ? document.getElementById(`ultimo_nivel_${idSuffix}`).value : '',
        institucion: document.getElementById(`institucion_${idSuffix}`) ? document.getElementById(`institucion_${idSuffix}`).value : '',
        entidad_federativa: document.getElementById(`entidad_federativa_${idSuffix}`) ? document.getElementById(`entidad_federativa_${idSuffix}`).value : '',
        documento_recibido: document.getElementById(`documento_recibido_${idSuffix}`) ? document.getElementById(`documento_recibido_${idSuffix}`).value : ''
    });
    });
    formJSON.academicos = formJSON.academicos || {};
    formJSON.academicos.niveles = niveles;


    console.log('formJSON:', JSON.stringify(formJSON, null, 2));

    alert('Formulario procesado. Revisa la consola para ver variables individuales y el JSON completo.');
  });

document.addEventListener('DOMContentLoaded', function() {
  const sections = Array.from(document.querySelectorAll('.salav-card'));
  if (!sections.length) return;

  let current = 0;
  sections.forEach((s, i) => { s.classList.toggle('active', i === 0); });

const dotsContainer = document.getElementById('sectionDots');
dotsContainer.innerHTML = '';

sections.forEach((_, i) => {
  const dot = document.createElement('div');                       
  dot.className = 'section-dot' + (i === 0 ? ' active' : '');
  dot.dataset.section = i;                                         
  dot.title = `Ir a sección ${i + 1}`;
  dot.setAttribute('role', 'button');                             
  dot.tabIndex = 0;

  dot.addEventListener('click', () => goTo(i));
  dot.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      goTo(i);
    }
  });

  dotsContainer.appendChild(dot);
});


  // progress UI
  const progressFill = document.getElementById('progressFill');
  const progressLabel = document.getElementById('progressLabel');
  const progressPercent = document.getElementById('progressPercent');
  function updateProgress() {
    const total = sections.length;
    const pct = Math.round(((current + 1) / total) * 100);
    if (progressFill) progressFill.style.width = pct + '%';
    if (progressLabel) progressLabel.textContent = `Sección ${current + 1} / ${total}`;
    if (progressPercent) progressPercent.textContent = `${pct}%`;
    
    Array.from(document.querySelectorAll('.section-dot')).forEach((d, idx) => {
      d.classList.toggle('active', idx === current);
      d.classList.toggle('completed', idx < current);
    });
  }
  
  updateProgress();

  
  let nav = document.querySelector('.navigation');
  if (!nav) {
    nav = document.createElement('div');
    nav.className = 'navigation';
    
    const form = document.getElementById('salav-form');
    form.appendChild(nav);
  }


  if (!nav.querySelector('.btn-prev')) {
    const prev = document.createElement('button');
    prev.type = 'button';
    prev.className = 'btn btn-prev';
    prev.textContent = 'Anterior';
    prev.addEventListener('click', () => goTo(current - 1));
    nav.appendChild(prev);
  }
  if (!nav.querySelector('.btn-next')) {
    const next = document.createElement('button');
    next.type = 'button';
    next.className = 'btn btn-next';
    next.textContent = 'Siguiente';
    next.addEventListener('click', () => goTo(current + 1));
    nav.appendChild(next);
  }
  if (!nav.querySelector('.btn-submit')) {
    const submit = document.createElement('button');
    submit.type = 'submit';
    submit.className = 'btn btn-submit';
    submit.textContent = 'Enviar formulario';
   
    nav.appendChild(submit);
  }

 
  const btnPrev = nav.querySelector('.btn-prev');
  const btnNext = nav.querySelector('.btn-next');
  const btnSubmit = nav.querySelector('.btn-submit');

  function goTo(index) {
    const total = sections.length;
    if (index < 0) index = 0;
    if (index > total - 1) index = total - 1;
    current = index;
    sections.forEach((s, i) => s.classList.toggle('active', i === current));
    updateProgress();
   
    const active = sections[current];
    if (active) active.scrollIntoView({ behavior: 'smooth', block: 'start' });

  
    if (btnPrev) btnPrev.style.visibility = (current === 0) ? 'hidden' : 'visible';
    if (btnNext) btnNext.style.display = (current === total - 1) ? 'none' : 'inline-flex';
    if (btnSubmit) btnSubmit.style.display = (current === total - 1) ? 'inline-flex' : 'none';
  }

  goTo(0);

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') goTo(current + 1);
    if (e.key === 'ArrowLeft') goTo(current - 1);
  });

  
document.querySelectorAll('form button[type="submit"]').forEach(btn => {
  if (!btn.closest('.navigation')) btn.remove();
});

// Asegúrate de que el submit del nav solo se vea en la última sección:
if (btnSubmit) btnSubmit.style.display = 'none';
function refreshNavVisibility() {
  const total = sections.length;
  btnPrev.style.visibility = (current === 0) ? 'hidden' : 'visible';
  btnNext.style.display = (current === total - 1) ? 'none' : 'inline-flex';
  btnSubmit.style.display = (current === total - 1) ? 'inline-flex' : 'none';
}
});

// Manejar carga de archivos
            const fileUploads = document.querySelectorAll('.file-upload');
            fileUploads.forEach(upload => {
                const input = upload.querySelector('input');
                const fileName = upload.nextElementSibling;
                
                upload.addEventListener('click', function() {
                    input.click();
                });
                
                input.addEventListener('change', function() {
                    if (input.files.length > 0) {
                        if (input.multiple) {
                            fileName.textContent = `${input.files.length} archivos seleccionados`;
                        } else {
                            fileName.textContent = input.files[0].name;
                        }
                    } else {
                        fileName.textContent = '';
                    }
                });
            });


/*
Autosave & restore form (vanilla JS)
- Guarda entradas en localStorage (debounced).
- Maneja checkboxes, radios, selects, textareas, inputs type=text/email/number/date.
- Maneja 1 archivo llamado "fotografia" usando IndexedDB (mejor) y muestra preview.
- Limpia el draft al hacer submit exitoso.
- Sincroniza entre pestañas con BroadcastChannel.
*/

(() => {
  // --- Obtener userId (querystring o sessionStorage) y form slug ---
  const urlParams = new URLSearchParams(window.location.search);
  const USER_ID = urlParams.get('user') || sessionStorage.getItem('salav:currentUserId') || 'anonymous_user';
  const formEl = document.getElementById('salav-form');
  const FORM_SLUG = (formEl && formEl.getAttribute('data-form')) ? formEl.getAttribute('data-form') : 'estudio_socioeconomico';

  // --- Claves dinámicas por usuario+form ---
  const FORM_ID = 'salav-form';
  const STORAGE_KEY = `salav:form:draft:v1:${USER_ID}:${FORM_SLUG}`;
  const FILE_DB = 'salav-files';
  const FILE_STORE = 'files';
  const FILE_KEY = `salav:file:${USER_ID}:${FORM_SLUG}:fotografia`; // key to store the blob in IndexedDB
  const AUTOSAVE_DELAY = 600; // ms debounce

  const form = document.getElementById(FORM_ID);
  if (!form) return;

  // --- IndexedDB helpers (vanilla minimal) ---
  function openDB() {
    return new Promise((resolve, reject) => {
      const req = indexedDB.open(FILE_DB, 1);
      req.onupgradeneeded = () => {
        req.result.createObjectStore(FILE_STORE);
      };
      req.onsuccess = () => resolve(req.result);
      req.onerror = () => reject(req.error);
    });
  }

  async function idbPut(key, value) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const tx = db.transaction(FILE_STORE, 'readwrite');
      tx.objectStore(FILE_STORE).put(value, key);
      tx.oncomplete = () => resolve();
      tx.onerror = () => reject(tx.error);
    });
  }

  async function idbGet(key) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const tx = db.transaction(FILE_STORE, 'readonly');
      const req = tx.objectStore(FILE_STORE).get(key);
      req.onsuccess = () => resolve(req.result);
      req.onerror = () => reject(req.error);
    });
  }

  async function idbDelete(key) {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const tx = db.transaction(FILE_STORE, 'readwrite');
      tx.objectStore(FILE_STORE).delete(key);
      tx.oncomplete = () => resolve();
      tx.onerror = () => reject(tx.error);
    });
  }

  // --- util debounce ---
  function debounce(fn, wait) {
    let t;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), wait);
    };
  }

  // --- serialize form values (no files) ---
  function serializeForm(formEl) {
    const data = {};
    const elements = Array.from(formEl.elements).filter(el => el.name && !el.disabled);
    for (const el of elements) {
      if (el.type === 'file') continue; // files handled separately
      if (el.type === 'checkbox') {
        if (!data[el.name]) data[el.name] = el.checked;
        else data[el.name] = el.checked; // override single checkbox (or keep last state)
      } else if (el.type === 'radio') {
        if (el.checked) data[el.name] = el.value;
      } else {
        data[el.name] = el.value;
      }
    }
    data.__savedAt = new Date().toISOString();
    return data;
  }

  // --- restore form values ---
  async function restoreForm() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const data = JSON.parse(raw);

      const elements = Array.from(form.elements).filter(el => el.name);
      for (const el of elements) {
        if (el.type === 'file') continue;
        if (el.type === 'checkbox') {
          if (data.hasOwnProperty(el.name)) el.checked = Boolean(data[el.name]);
        } else if (el.type === 'radio') {
          if (data[el.name] !== undefined) el.checked = (el.value === data[el.name]);
        } else {
          if (data[el.name] !== undefined) el.value = data[el.name];
        }
      }

      // restore fotografia preview from IndexedDB if exists
      const blob = await idbGet(FILE_KEY).catch(() => null);
      if (blob) populateFilePreview(blob);
    } catch (e) {
      console.warn('restoreForm error', e);
    }
  }

  // --- save to localStorage (and optionally file to idb) ---
  const saveDraft = debounce(async () => {
    try {
      const data = serializeForm(form);
      const hasFile = await idbGet(FILE_KEY).then(r => !!r).catch(() => false);
      data.__hasFile = hasFile;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      broadcastDraftSaved();
    } catch (e) {
      console.warn('saveDraft error', e);
    }
  }, AUTOSAVE_DELAY);

  // --- file input handling ---
  const fileInput = form.querySelector('input[type="file"][name="fotografia"]');
  const fileNameDiv = document.getElementById('fotografia-name');

  function populateFilePreview(blob) {
    if (!blob) {
      if (fileNameDiv) fileNameDiv.textContent = '';
      return;
    }
    const url = URL.createObjectURL(blob);
    if (fileNameDiv) {
      const img = document.createElement('img');
      img.src = url;
      img.style.maxWidth = '120px';
      img.style.maxHeight = '120px';
      img.style.display = 'block';
      img.style.marginTop = '6px';
      fileNameDiv.innerHTML = '';
      fileNameDiv.appendChild(img);
    }
  }

  if (fileInput) {
    fileInput.addEventListener('change', async (e) => {
      const f = e.target.files[0];
      if (!f) {
        // user cleared the input -> remove stored file and name
        await idbDelete(FILE_KEY).catch(()=>{});
        localStorage.removeItem(`${STORAGE_KEY}:fotografia:name`);
        saveDraft();
        populateFilePreview(null);
        return;
      }
      try {
        // store the blob in IndexedDB
        await idbPut(FILE_KEY, f);
        // store filename in localStorage (so we can re-append on submit)
        localStorage.setItem(`${STORAGE_KEY}:fotografia:name`, f.name);
        if (fileNameDiv) fileNameDiv.textContent = f.name;
        populateFilePreview(f);
      } catch (err) {
        console.warn('Error saving file to idb', err);
        // fallback: try storing small base64 in localStorage (not recommended)
        const dataUrl = await readFileAsDataURL(f);
        try {
          localStorage.setItem(`${STORAGE_KEY}:fotografia:dataurl`, dataUrl);
          localStorage.setItem(`${STORAGE_KEY}:fotografia:name`, f.name);
          if (fileNameDiv) fileNameDiv.textContent = f.name + ' (guardada en localStorage)';
          const img = document.createElement('img');
          img.src = dataUrl;
          img.style.maxWidth = '120px';
          img.style.maxHeight = '120px';
          fileNameDiv.innerHTML = '';
          fileNameDiv.appendChild(img);
        } catch (e) {
          console.error('No se pudo guardar la foto en localStorage (posible límite de tamaño).', e);
        }
      } finally {
        saveDraft();
      }
    });
  }

  function readFileAsDataURL(file) {
    return new Promise((res, rej) => {
      const fr = new FileReader();
      fr.onload = () => res(fr.result);
      fr.onerror = () => rej(fr.error);
      fr.readAsDataURL(file);
    });
  }

  // If a dataURL fallback exists (from earlier fallback), restore it
  async function restoreFileFallbackIfAny() {
    const dataUrl = localStorage.getItem(`${STORAGE_KEY}:fotografia:dataurl`);
    if (dataUrl) {
      const res = await fetch(dataUrl);
      const blob = await res.blob();
      populateFilePreview(blob);
    }
  }

  // --- wire input events ---
  const watchSelector = 'input:not([type=file]), textarea, select, input[type=checkbox], input[type=radio]';
  form.querySelectorAll(watchSelector).forEach(el => {
    el.addEventListener('input', saveDraft);
    el.addEventListener('change', saveDraft);
  });

  // save on beforeunload as last resort
  window.addEventListener('beforeunload', saveDraft);

  // restore on load
  document.addEventListener('DOMContentLoaded', async () => {
    await restoreForm();
    await restoreFileFallbackIfAny();
  });

  // on successful submit: clear draft
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const currentFile = (fileInput && fileInput.files && fileInput.files[0]) ? fileInput.files[0] : null;
    if (!currentFile) {
      const blob = await idbGet(FILE_KEY).catch(() => null);
      if (blob) {
        const storedName = localStorage.getItem(`${STORAGE_KEY}:fotografia:name`) || 'fotografia.jpg';
        formData.append('fotografia', blob, storedName);
      } else {
        // if we only have dataurl fallback, try to use it
        const dataUrl = localStorage.getItem(`${STORAGE_KEY}:fotografia:dataurl`);
        if (dataUrl) {
          const res = await fetch(dataUrl);
          const blobFromDataUrl = await res.blob();
          const storedName = localStorage.getItem(`${STORAGE_KEY}:fotografia:name`) || 'fotografia.jpg';
          formData.append('fotografia', blobFromDataUrl, storedName);
        }
      }
    }

    // TODO: reemplaza la siguiente parte por tu fetch/ajax real a tu endpoint.
    // Ejemplo:
    // const resp = await fetch('/tu-endpoint', { method: 'POST', body: formData });
    // if (resp.ok) clearDraft();

    console.log('Formulario listo para enviar; FormData preparado. (Simulación)');
    clearDraft();
  });

  // --- clear draft ---
  async function clearDraft() {
    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem(`${STORAGE_KEY}:fotografia:dataurl`);
    localStorage.removeItem(`${STORAGE_KEY}:fotografia:name`);
    try { await idbDelete(FILE_KEY); } catch(_) {}
    broadcastDraftCleared();
    if (fileNameDiv) fileNameDiv.textContent = '';
    console.log('Draft cleared');
  }

  // --- BroadcastChannel to sync tabs (channel scoped per user+form) ---
  const bcName = `salav-draft:${USER_ID}:${FORM_SLUG}`;
  const bc = ('BroadcastChannel' in window) ? new BroadcastChannel(bcName) : null;
  function broadcastDraftSaved() { if (!bc) return; bc.postMessage({ type: 'saved', ts: Date.now() }); }
  function broadcastDraftCleared() { if (!bc) return; bc.postMessage({ type: 'cleared', ts: Date.now() }); }
  if (bc) {
    bc.onmessage = (ev) => {
      if (!ev.data) return;
      if (ev.data.type === 'saved') {
        // podrías mostrar un pequeño aviso "Borrador guardado en otra pestaña"
      } else if (ev.data.type === 'cleared') {
        // si borraron en otra pestaña, actualiza UI
        // por simplicidad llamamos a restoreForm para refrescar estado
        restoreForm();
      }
    };
  }

  // expose small API for debugging
  window._SALAV_DRAFT = {
    saveDraft,
    restoreForm,
    clearDraft,
    idbGet,
    idbPut,
    STORAGE_KEY,
    FILE_KEY,
    USER_ID,
    FORM_SLUG,
  };

})();
</script>
</body>

</html>